/*! Arlima v3.1.beta.64 */
function arlimaNestedSortable(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=jQuery.noConflict(),r=a.$elem.find(".articles"),s=2,t=0,u=null,v=!1,w=function(a,b){B(a.placeholder,b,t),t=b},x=function(a){return Math.min(Math.floor(a/30),2)},y=function(a){var b;e=a.placeholder.prev(),f=a.placeholder.next(),e[0]==a.item[0]&&(e=e.prev()),f[0]==a.item[0]&&(f=f.next()),g=e.length?e.offset().top+e.height():0,h=f.length?f.offset().top+f.height()/3:0,c=f.length?A(f):0,d=e.length?(b=A(e)+1)>s?s:b:0},z=function(a){return f.length||y(a),f.length&&f[0].arlimaArticle.isChild()},A=function(a){var b=a.eq(0).css("margin-left"),c=x(b&&-1!=b.indexOf("px")?b.slice(0,-2):0);return 0==c&&a.eq(0).hasClass("floating")&&(c=2),c},B=function(a,b,c){return a.each(function(){var a=q(this);c=c||A(a),q(this).removeClass("list-item-depth-"+c).addClass("list-item-depth-"+b)})},C=function(a,b){return a.each(function(){var a=q(this),c=A(a);q(this).removeClass("list-item-depth-"+c).addClass("list-item-depth-"+(c+b))})},D=function(a){var b=q();return a.each(function(){for(var a=q(this),c=A(a),d=a.next();d.length&&A(d)>c;)b=b.add(d),d=d.next()}),b},E=function(a){return a.closest(".article-list").get(0).arlimaList.data.id},F=function(a){a.get(0).arlimaArticle.listID=E(a)},G=function(a){var b=a.item[0].arlimaArticle||a.item.context.arlimaArticle,c=!z(a)||b.canBeChild()&&!k,d=window.arlimaDragFromList&&window.arlimaDragFromList!=window.arlimaDragToList;return c?a.sender&&a.sender.hasClass("ui-draggable")||a.item.hasClass("ui-draggable")?!0:window.arlimaDragFromList.data.isImported?d:!0:!1},H=function(){n=!1,m=-1,v=!1},I=function(a){return j.children().insertAfter(a.item)},J=function(){a.size()>50&&a.$elem.find(".article:last")[0].arlimaArticle.remove()},K=function(a,b){b?v&&(a.placeholder.css({backgroundColor:"",borderColor:u,opacity:"1"}),v=!1):(null===u&&"red"!=a.placeholder.css("border-color")&&(u=a.placeholder.css("border-color")),a.placeholder.css({backgroundColor:"pink",borderColor:"red",opacity:.25}),v=!0)},L=function(b,c){window.ArlimaUtils.log("Finished drop on "+a.data.id),J(),setTimeout(function(){a.updateParentProperties(),window.ArlimaArticleForm.isEditing(b)?window.ArlimaArticleForm.setupForm():window.ArlimaArticlePreview.isVisible()&&window.arlimaDragArticleParent&&window.ArlimaArticleForm.article.data.id==window.arlimaDragArticleParent&&window.ArlimaArticlePreview.reload()},200),window.ArlimaUtils.highlight(b),c&&!a.data.isImported&&a.toggleUnsavedState(!0),a.$elem.trigger("change"),a.$elem.css("z-index",1),a.$elem.siblings().css("z-index",1),b[0].style.top=0,H()},M=function(){a.makeFloatedChildrenCollapsible()};r.sortable({items:".article",placeholder:"sortable-placeholder",connectWith:".article-list:not(.imported) .articles",appendTo:"body",helper:"clone",distance:10,zIndex:9999,over:function(b,c){window.arlimaDragToList=a,c.item.hasClass("ui-draggable")||(c.item.data("sortableItem").scrollParent=c.placeholder.parent(),c.item.data("sortableItem").overflowOffset=c.placeholder.parent().offset())},start:function(c,d){if(!d.item.hasClass("ui-draggable")){d.item.data("sortableItem").scrollParent=d.placeholder.parent(),d.item.data("sortableItem").overflowOffset=d.placeholder.parent().offset();var e,f,g,h,r,s;if(j=d.helper.children(".children-transport"),window.arlimaMoveBetweenLists=!1,window.arlimaDragFromList=a,window.arlimaDragToList=a,b=A(d.item),m=d.item.prevAll().length,w(d,b),n=d.item[0].arlimaArticle.isChild(),f=d.item.next()[0]==d.placeholder[0]?d.item.next():d.item,g=D(f),j.append(g),k=g.length>0,p=!(k||"arlimaArticle"in d.item[0]&&!d.item[0].arlimaArticle.canBeChild()),window.arlimaDragArticleParent=!1,ArlimaUtils.hasMetaKeyPressed(c)||a.data.isImported){l=!0,o=d.item.clone(!1).show();var t=new ArlimaArticle(q.extend(!0,{},d.item.get(0).arlimaArticle.data),null,o,!a.data.isImported);a.addArticle(t,!1),o.css("opacity","0.5").insertAfter(d.item),t.setState("default");var u=!1,v=g.get();r=!1,s=null,q(v).each(function(){var b=new ArlimaArticle(q.extend(!0,{},this.arlimaArticle.data),a.data.id,!1,!a.data.isImported);b.$elem.addClass(this.arlimaArticle.data.options.floating&&r?"list-item-depth-2":"list-item-depth-1"),r=this.arlimaArticle.data.options.floating&&!this.arlimaArticle.data.options.inlineWithChild,r&&(u=!0),a.addArticle(b,!1),s?b.$elem.insertAfter(s):(b.$elem.insertAfter(o),s=b.$elem)}),u&&M()}else l=!1,d.item.get(0).arlimaArticle.isChild()&&(window.arlimaDragArticleParent=d.item.get(0).arlimaArticle.getParentArticle().data.id);e=j.outerHeight(),e+=e>0?1*d.placeholder.css("margin-top").slice(0,-2)+4:0,e+=d.helper.outerHeight(),i=e,e-=2,d.placeholder.height(e),h=d.placeholder.next(),h.css("margin-top",i+"px"),d.placeholder.detach(),q(this).sortable("refresh"),d.item.after(d.placeholder),h.css("margin-top",0),y(d)}},beforeStop:function(a,b){window.cancelArlimaArticleDrop=G(b)?!1:!0},stop:function(c,d){var e,f,g=t-b,h=d.item.closest(".article-list").get(0),i=d.item.prevAll().length;if(!d.item.hasClass("ui-draggable")){if(window.cancelArlimaArticleDrop)return q(this).sortable("cancel"),l||I(d),void(o&&o.remove());a.data.isImported&&(d.item[0].arlimaArticle.listID=h.arlimaList.data.id,d.item[0].arlimaArticle.addClickEvents(!a.data.isImported),ArlimaArticleForm.article&&ArlimaArticleForm.article.opt("overridingURL")==d.item[0].arlimaArticle.opt("overridingURL")&&(ArlimaArticleForm.article=!1,ArlimaArticleForm.edit(d.item[0].arlimaArticle),ArlimaArticleForm.article.data.image&&ArlimaArticleForm.article.data.image.url&&(window.ArlimaImageUploader.showPreloader(),window.ArlimaBackend.saveExternalImage(d.item[0].arlimaArticle.data.image.url,"",function(a){window.ArlimaImageUploader.removeNotice(),a&&window.ArlimaImageManager.setNewImage(a.url,a.attachment,!1,ArlimaArticleForm.article.data.image.size,ArlimaArticleForm.article.data.image.alignment)})))),e=I(d),e.length>0&&e.each(function(){F(q(this)),this.arlimaArticle.addClickEvents(!a.data.isImported)}),0!==g&&(B(d.item,t),C(e,g)),a.updateParentProperties(),f=d.item[0].arlimaArticle.isChild(),l||!h||h.arlimaList.data.isImported||i==m&&f==n||h.arlimaList.toggleUnsavedState(!0),a.data.isImported||l||h&&h.arlimaList.data.id==a.data.id&&b==t||a.toggleUnsavedState(!0),l&&(o.css("opacity",1),window.ArlimaUtils.highlight(o)),window.arlimaMoveBetweenLists?H():L(d.item,l),M()}},sort:function(a,b){var g=b.helper.offset(),j=g.left,l=j-b.placeholder.parent().offset().left,m=x(l);k&&(m=0),b.placeholder.parent().hasClass("articles")||(e.length?e.after(b.placeholder):r.prepend(b.placeholder)),y(b),G(b)?K(b,!0):K(b,!1),m>1&&!e.is(".list-item-depth-2, .list-item-depth-1")&&(m=1),b.helper[0].className=b.helper[0].className.replace(/ *helper-item-depth-. */,"")+" helper-item-depth-"+m,(e.length&&!e[0].arlimaArticle.isChild()&&!e[0].arlimaArticle.canHaveChildren()||!p)&&(m=0),m>d?m=d:c>m&&(m=c),m!=t&&!k&&p&&w(b,m),h&&g.top+i>h&&(f.after(b.placeholder),y(b),q(this).sortable("refreshPositions"))},receive:function(b,c){if(!window.cancelArlimaArticleDrop){var d;if(c.sender.hasClass("ui-draggable")){var e=new ArlimaArticle(q.extend(!0,{},c.item.context.arlimaArticle.data),a.data.id,!1,!a.data.isImported);e.$elem.insertAfter(a.$elem.find("ui-draggable")),e.$elem.addClass("list-item-depth-"+t).insertAfter(q(".ui-draggable",this)),a.$elem.find(".ui-draggable").remove(),d=e.$elem}else d=c.item,c.item[0].arlimaArticle.listID=a.data.id,c.item[0].arlimaArticle.addClickEvents(!0);L(d,!0),window.arlimaMoveBetweenLists=!0,setTimeout(M,200),window.ArlimaListContainer.updateZIndexes(),window.ArlimaListContainer.focus(a)}}}).each(function(){M()}).bind("change",function(){M()})}var ArlimaUtils=function(a,b,c){var d={serverTime:0,showLogTrace:!1,isFutureDate:function(a){return a>this.serverTime},hasMetaKeyPressed:function(a){return a&&(a.ctrlKey||a.metaKey)},log:function(a,d){if("object"==typeof a&&a.stack)b.ArlimaJS.sendJSErrorsToServerLog&&ArlimaBackend.logJSError(a.message,a.stack,"?","?"),"console"in b&&"function"==typeof b.console.error&&b.console.error(a.stack);else{if(d===c&&(d="log"),"log"==d&&!ArlimaJS.devMode)return;"console"in b&&"function"==typeof b.console[d]&&(b.console[d](a),this.showLogTrace&&b.console.log((new Error).stack.split("\n").slice(2).join("\n")))}},makeCollapsing:function(b,c){var d=!1;b.find(".collapse-toggle").click(function(){if(!d){d=!0;var e=b.find(".inside");e.is(":visible")?(a(this).removeClass("open"),e.slideUp("fast",function(){d=!1,"function"==typeof c&&c()})):(a(this).addClass("open"),e.slideDown("fast",function(){d=!1,"function"==typeof c&&c()}))}}),b.find("> h3").click(function(){b.find(".collapse-toggle").trigger("click")})},selectVal:function(a,b,c){var d=a.find('option[value="'+b+'"]');if(0==d.length){if(""!=b&&"aligncenter"!=b)throw Error("Trying to set value ("+b+") for a select[name="+(a.attr("name")||a.attr("data-prop"))+"] but no option exists for that value")}else a.val()!=b&&(d.get(0).selected=!0,c&&a.trigger("change"))},isImagePath:function(b){b||(b=""),b=b.toLowerCase();var c=!1;return a.each([".jpg",".jpeg",".gif",".png"],function(a,d){return b.indexOf(d)>-1?(c=!0,!1):void 0}),c},getUnsavedListInFocus:function(){if(b.ArlimaArticleForm.article){var c=b.ArlimaListContainer.list(ArlimaArticleForm.article.listID);if(c.hasUnsavedChanges())return c}if(ArlimaListContainer.lastTouchedList&&ArlimaListContainer.list(ArlimaListContainer.lastTouchedList)&&ArlimaListContainer.list(ArlimaListContainer.lastTouchedList).hasUnsavedChanges())return ArlimaListContainer.list(ArlimaListContainer.lastTouchedList);var d=[];return a.each(ArlimaListContainer.lists,function(a,b){b.hasUnsavedChanges()&&d.push(b)}),1==d.length?d[0]:void 0},shake:function(a){"hasUnsavedChanges"in a&&(a=a.$elem);try{a.effect("shake",{times:4,distance:10},500)}catch(b){}},highlight:function(a){try{a.effect("highlight",{color:"rgba(255,255,255, .2)"})}catch(b){}},makeDraggable:function(a){a.draggable({appendTo:"body",helper:"clone",sender:"postlist",connectToSortable:".article-list:not(.imported) .articles",revert:"invalid",start:function(a,b){b.helper.addClass("article"),b.helper.css("z-index","99999")}})}},e=(new Date).getTime();return setInterval(function(){var a=(new Date).getTime();ArlimaUtils.serverTime+=a-e,e=a},1e3),d}(jQuery,window),ArlimaBackend=function(a,b,c){var d,e=b.log;return a(function(){d=a("body")}),{backendVersion:!1,queryPosts:function(a,b){this._ajax("arlima_query_posts",a,b)},getLaterVersion:function(a,b,c){this._ajax("arlima_check_for_later_version",{alid:a,version:b},c)},getPost:function(a,b){this._ajax("arlima_get_post",{postid:a},b,"json",!1)},getPostAttachments:function(a,b){this._ajax("arlima_get_attached_images",{postid:a},b)},connectAttachmentToPost:function(a,b,c){this._ajax("arlima_connect_attach_to_post",{attachment:b,post:a},c)},saveList:function(a,b,c,d){this._ajax("arlima_save_list","alid="+a+"&articles="+encodeURIComponent(JSON.stringify(b))+"&scheduleTime="+c,d,"json",!0,!1)},updateListVersion:function(a,b,c,d){this._ajax("arlima_update_list_version","alid="+a+"&articles="+encodeURIComponent(JSON.stringify(c))+"&version="+b,d,"json",!0,!1)},deleteScheduledVersion:function(a,b){this._ajax("arlima_delete_list_version","alvid="+a,b,"json",!0,!1)},savePreview:function(a,b,c){this._ajax("arlima_save_list","alid="+a+"&preview=1&articles="+encodeURIComponent(JSON.stringify(b)),c,"json",!0,!1)},removeImageVersions:function(a,b){this._ajax("arlima_remove_image_versions",{attachment:a},b)},loadCustomTemplateData:function(a){this._ajax("arlima_print_custom_templates",{},a)},loadListData:function(a,b,c){this._ajax("arlima_add_list_widget",{alid:a,version:b},c)},loadListSetup:function(a){this._ajax("arlima_get_list_setup",{},a)},saveExternalImage:function(a,b,c){var d=a.substr(a.lastIndexOf(".")+1).toLowerCase(),e=d.indexOf("?");e>-1&&(d=d.substr(0,e)),this._ajax("arlima_save_external_img",{imgurl:a,postid:b},c)},saveImage:function(a,b,c,d){this._ajax("arlima_save_image",{image:a,postid:b,name:c},d)},saveListSetup:function(a,b){this._ajax("arlima_save_list_setup",{lists:a},b)},loadScissorsHTML:function(a,b){this._ajax("arlima_get_scissors",{attachment:a},b,"html")},duplicateImage:function(a,b){this._ajax("arlima_duplicate_image",{attachment:a},b)},logJSError:function(a,b,c,d,e){this._ajax("arlima_log_js",{message:a,stack:b,file:c,line:d},e)},displayNewVersionMessage:function(b){b||(b=this.backendVersion);var c=a("#arlima-version-message");c.is(":visible")||(c.find(".version").text(b),a.fancybox({href:"#arlima-version-message",height:400,width:400}))},_ajax:function(b,f,g,h,i,j){var k=this;"string"==typeof f?f+="&action="+b+"&_ajax_nonce="+c.arlimaNonce:(f.action=b,f._ajax_nonce=c.arlimaNonce),void 0===i&&(i=!0),void 0===h&&(h="json"),j=void 0===j?!0:j,d&&i&&d.addClass("wait-loading"),a.ajax({url:c.ajaxURL,type:"POST",data:f,processData:j,dataType:h,success:function(a,b,e){var f=(e.getResponseHeader("X-Arlima-Version")||"").split("__")[0];f&&(k.backendVersion&&k.backendVersion!=f&&(k.displayNewVersionMessage(f),setInterval(function(){k.displayNewVersionMessage(f)},15e4)),k.backendVersion=f),d&&d.removeClass("wait-loading"),a&&-1!=a?a.error&&(alert(a.error),a=!1):(alert(c.lang.loggedOut),a=!1),"function"==typeof g&&g(a)},error:function(a,b){if(d.removeClass("wait-loading"),0==a.status)return void e("The request is refused by browser, most probably because of fast reloading of the page before ajax call was completed","warn");var c=a.responseText;if("undefined"!=typeof JSON){var f=!1;try{f=JSON.parse(c)}catch(h){}f&&"undefined"!=typeof f.error&&(c=f.error)}alert("ERROR:\n------------\n"+c),e(a,"error"),e(b,"error"),"function"==typeof g&&g(!1)}})}}}(jQuery,ArlimaUtils,ArlimaJS),ArlimaFormBuilder=function(a,b){var c={type:"text",property:"",value:"",width:"100%",rows:!1,label:{text:"",display:"inline",description:""}},d=function(a,b){var c=a.label.placeholder?' placeholder="'+a.label.placeholder+'"':"";return b=b||"",a.rows?"<textarea "+b+' rows="'+a.rows+'" data-prop="'+a.property+'"'+c+">"+a.value+"</textarea>":"<input "+b+' type="text" data-prop="'+a.property+'" value="'+a.value+'"'+c+" />"},e=function(a){return'<input type="number" data-prop="'+a.property+'" value="'+a.value+'" />'},f=function(a){var c=a.label.yes||b.lang.yes,d=a.label.no||b.lang.no,e=a.value?' selected="selected"':"",f=a.value?"":' selected="selected"';return'<select data-prop="'+a.property+'"><option value="1"'+e+">"+c+'</option><option value=""'+f+">"+d+"</option></select>"},g=function(b){var c="";return a.each(b.options.split(","),function(d,e){e=a.trim(e),c+='<option value="'+e+'"'+(e==b.value?' selected="selected"':"")+">"+e+"</option>"}),'<select data-prop="'+b.property+'">'+c+"</select>"};return{$elem:null,TYPES:{BOOL:"boolean",TEXT:"text",NUMBER:"number",LIST:"list",DATE:"date"},defaultFieldDefinition:c,getFieldHTML:function(a){var b=a.display&&"block"!=a.display?"inline":"block",c=a.label&&a.label.display?a.label.display:"block",h="label-display-"+c,i=a.width?' style="width:'+a.width+'"':"",j=a.label.description?' title="'+a.label.description+'"':"",k='<div class="form-field '+b+" "+h+" type-"+a.type+'"'+i+j+">";switch(!a.label.placeholder&&a.label.text&&(k+="<strong>"+a.label.text+"</strong>"),a.type){case this.TYPES.BOOL:k+=f(a);break;case this.TYPES.TEXT:k+=d(a);break;case this.TYPES.DATE:k+=d(a,'style="position: relative; z-index: 100000;"');break;case this.TYPES.NUMBER:k+=e(a);break;case this.TYPES.LIST:k+=g(a);break;default:k+="<em>Unknown field type "+a.type+"</em>"}return k+"</div>"},addFields:function(b){var c="",d=[],e=this;a.each(b,function(a,b){c+=e.getFieldHTML(b),b.type==e.TYPES.DATE&&d.push(b)}),this.$elem.append(c),setTimeout(function(){d.length&&a.each(d,function(a,b){var c=b.settings||{};e.$elem.find('input[data-prop="'+b.property+'"]').datepicker(c)})},1e3)},inputs:function(){return this.$elem.find(".form-field input, .form-field select, .form-field textarea")},clear:function(){this.$elem.find(".form-field").remove()},init:function(a){this.$elem=a}}}(jQuery,ArlimaJS),ArlimaArticleSettingsMenu=function(a,b){var c={hasFocus:!1,$button:!1,$dropDown:!1,defaultTemplate:!1,templateFormatsMap:{},open:function(){this.hasFocus=!0,this.$button.addClass("active"),this.$dropDown.slideDown("fast",function(){c.hasFocus=!0})},setup:function(b){this.$dropDown.find("i.fa-check-square-o").removeClass("fa-check-square-o").addClass("fa-square-o");var d=window.ArlimaListContainer.list(b.listID);if(this.defaultTemplate=d.data.options.template,this.$dropDown.find(".template .nav").show().each(function(){return a(this).attr("data-value")==c.defaultTemplate?(a(this).hide(),!1):void 0}),d.data.options.allows_template_switching&&b.canHaveTemplate()){this.$dropDown.find(".nav.template .disabled").removeClass("disabled");var e=this.$dropDown.find(".nav.template .nav");if(a.isArray(d.data.options.available_templates)&&d.data.options.available_templates.length)e.not(":eq(0)").addClass("disabled"),a.each(d.data.options.available_templates,function(a,b){e.filter('[data-value="'+b+'"]').removeClass("disabled").insertAfter(e.eq(0))}),this.$dropDown.attr("data-template-sort","available");else if("name"!=this.$dropDown.attr("data-template-sort")){this.$dropDown.attr("data-template-sort","name");var f={},g=[];e.not(":eq(0)").each(function(){var b=a(this);f[b.attr("data-value")]=b.clone(!0),g.push(b.attr("data-value")),b.remove()}),g.sort(),a.each(g,function(a,b){e.parent().append(f[b])})}}else this.$dropDown.find(".nav.template .nav").addClass("disabled");b.canPreview()?(this.$dropDown.find(".nav.format .disabled").removeClass("disabled"),this.onTemplateChange(window.ArlimaArticleForm.article.getTemplate())):this.$dropDown.find(".nav.format .nav").addClass("disabled"),this.$dropDown.children().each(function(){var c=a(this),d=c.attr("data-prop"),e="";if(d.indexOf(":")>0){var f=d.split(":");e=f[0]in b.data?b.data[f[0]][f[1]]||"":""}else e=b.data[d]||"";c.find(".sub .nav").each(function(){return a(this).attr("data-value")==e?(a(this).find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),!1):void 0})})},onTemplateChange:function(b){var c=this.$dropDown.find(".format .nav");b in this.templateFormatsMap&&0!=this.templateFormatsMap[b].length?(-1==a.inArray(window.ArlimaArticleForm.opt("format"),this.templateFormatsMap[b])&&(window.ArlimaArticleForm.article.data.options.format="",d(c.eq(0))),c.addClass("disabled").eq(0).removeClass("disabled"),a.each(this.templateFormatsMap[b],function(a,b){c.filter('*[data-value="'+b+'"]').removeClass("disabled")})):c.removeClass("disabled")},onMouseEnter:function(){this.isOpen()&&(this.hasFocus=!0)},onMouseLeave:function(){this.hasFocus=!1,setTimeout(function(){c.hasFocus||c.close()},1e3)},close:function(){this.hasFocus=!1,this.$button.removeClass("active"),this.$dropDown.slideUp("fast")},isOpen:function(){return this.$dropDown.is(":visible")},addSelect:function(e){var f=a('<div class="nav">'+e.attr("data-label")+'<div class="sub"></div></div>'),g=f.find(".sub");f.addClass(e.attr("data-prop").split(":").pop()).attr("data-prop",e.attr("data-prop")).bind("mouseenter",function(){c.$dropDown.find(".sub").hide();var a=f.position();g.css({right:a.left+c.$dropDown.outerWidth()-2+"px",top:a.top+"px"}).show()}).bind("mouseleave",function(){g.hide()}),g.bind("mouseover",function(){c.hasFocus=!0}).bind("mouseleave",function(){c.onMouseLeave()}),e.find("option").each(function(){var e=a('<div class="nav" data-value="'+a(this).attr("value")+'"><i class="fa fa-square-o"></i> '+a(this).text()+"</div>");e.click(function(){if(e=a(this),!e.hasClass("disabled")){var f=e.find("i");if(f.hasClass("fa-check-square-o"))"options:scheduled"==e.parent().parent().attr("data-prop")&&window.ArlimaScheduledIntervalPicker.open();else{d(e);var g=e.parent().parent().attr("data-prop"),h=e.attr("data-value"),i=window.ArlimaArticleForm.$form.find('select[data-prop="'+g+'"]');b.selectVal(i,h,!0),i.hasClass("templates")&&c.onTemplateChange(h||c.defaultTemplate),"options:scheduled"==g&&(h?window.ArlimaScheduledIntervalPicker.open():window.ArlimaScheduledIntervalPicker.removePickedInterval())}}}),g.append(e)}),this.$dropDown.append(f)},init:function(b,d){this.$dropDown=d,this.$button=b,d.slideUp("fast"),b.bind("mouseenter click",function(){c.isOpen()||c.open(),a(this).blur()}).bind("mouseleave",function(){c.onMouseLeave()}).bind("mouseover",function(){c.onMouseEnter()}),d.bind("mouseleave",function(){c.onMouseLeave()}).bind("mouseenter",function(){c.onMouseEnter()})}},d=function(a){var b=a.find("i");b.hasClass("fa-check-square-o")||(a.siblings().find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),b.removeClass("fa-square-o").addClass("fa-check-square-o"))};return c}(jQuery,ArlimaUtils),ArlimaList=function(a,b,c,d,e){"use strict";function f(c){this.$elem=a(k(c)),this._isUnsaved=!1,this._hasLoadedScheduledVersion=!1;var d=this,e=this.$elem.find(".articles");if(this.$elem.on("mousedown",function(){b.ArlimaListContainer.focus(d)}).resizable({containment:"parent",start:function(){d.$elem.css("overflow","hidden"),e.css("overflow-y","hidden"),e.find(".article").css("visibility","hidden")},stop:function(){d.$elem.css("overflow","visible"),d.$elem.trigger("resized"),e.find(".article").css("visibility","visible"),e.css("height","100%").css({height:e.height()+"px",overflowY:"auto"})}}).draggable({containment:"parent",snap:20,handle:".header",stop:function(){d.$elem.trigger("dragged")}}),c.isImported){this.$elem.addClass("imported"),setTimeout(function(){d.$elem.find(".article .remove").remove(),d.$elem.find(".footer .save").remove(),d.$elem.find(".footer .preview").remove(),d.$elem.find(".header").attr("title",c.id)},50);var f=setInterval(function(){d.reload()},9e4);this.$elem.bind("removedFromContainer",function(){clearInterval(f)})}this.$elem.bind("Arlima.addedToContainer",function(){e.css("height",e.height()+"px"),arlimaNestedSortable(d)}),this.setData(c),m(this),this.$elem.get(0).arlimaList=this}var g=a(document);f.prototype.toString=function(){return'"'+this.data.title+'" (id:'+this.data.id+")"},f.prototype.displayTitleMessage=function(a,b,c){a?this.$elem.find(".schedule-notice").css("color",c||"#999").html("("+a+")").blink(b?1e3*b:!1):this.$elem.find(".schedule-notice").html("")},f.prototype.getArticleData=function(){var a=[],b=[],c=-1,d=!1;return this.$elem.find(".article").each(function(){if(this.arlimaArticle.data.children=[],this.arlimaArticle.data.options.floating=!1,this.arlimaArticle.isChild()){c++;var e=b[parseInt(this.arlimaArticle.data.parent,10)];-1!=e.parent?(e.options.floating=!0,this.arlimaArticle.data.options.floating=!0,this.arlimaArticle.data.options.inlineWithChild=d,b[e.parent].children.push(this.arlimaArticle.data)):(d=c,e.children.push(this.arlimaArticle.data))}else c=-1,a.push(this.arlimaArticle.data);b.push(this.arlimaArticle.data)}),a},f.prototype.size=function(){return this.$elem.find(".article").length},f.prototype.numSections=function(){return this.$elem.find(".article.section-divider").length},f.prototype.updateSecondLevelArticleClasses=function(){this.$elem.find(".list-item-depth-1").each(function(){for(var b=this,c=!1,d=!1;b=a(b).next();){var e=a(b);if(!e.hasClass("list-item-depth-2")){c&&c.addClass("last");break}d?e.removeClass("first").removeClass("last"):(a(b).addClass("first").removeClass("last"),d=!0),c=e}})},f.prototype.setArticles=function(b){this.$elem.find(".articles").html("");var c,d=this,e=!this.data.isImported;a.each(b,function(b,f){d.addArticle(new ArlimaArticle(f,d.data.id,!1,e),!1),c=!1,f.children.length>0&&a.each(f.children,function(a,b){var f=new ArlimaArticle(b,d.data.id,!1,e);f.$elem.addClass(b.options.floating&&c&&void 0!==b.options.inlineWithChild?"list-item-depth-2":"list-item-depth-1"),c=b.options.floating,d.addArticle(f,!1)})}),this.updateParentProperties()},f.prototype.makeFloatedChildrenCollapsible=function(){var b=this;e.log("Making floated children collapsible for "+this.data.id),a(".child-toggler, .article-children",this.$elem).remove(),a(".list-item-depth-1",this.$elem).each(function(){var c=[],d=this;for(delete this.arlimaArticle.data.options.inlineWithChild;(d=a(d).next())&&a(d).hasClass("list-item-depth-2");)c.push(d[0]);if(!c.length)return void a(this).removeClass("contains-toggled-children").removeClass("toggled-children");var e=a(this),f=a(".article-title",e),g=a('<div class="article-children" />').insertAfter(f),h=parseInt(100/(c.length+1),10),i=0,j=function(b,c){var d=a('<span class="child" />').appendTo(g);return d[0].arlimaArticle=b.arlimaArticle,d.text(a(".article-title",b).text()),d.attr("title",d.text()),d.css("width",h+"%"),d.css("left",h*c+"%"),d};e.addClass("contains-toggled-children"),j(e,0),a(c).removeClass("last").removeClass("first").each(function(b,d){var e=j(this,b+1);ArlimaArticleForm.isEditing(e)&&e[0].arlimaArticle.setState("editing"),a(this).hide(),b==c.length-1&&(a(d).addClass("last"),i=e.outerWidth()),0==b&&a(d).addClass("first"),e.click(function(b){return b.target=d,a(d).trigger(b),!1})});var k=a('<span class="child-toggler">&#9660;</span>').css("left","calc("+i*(c.length+1)+" - 16px)").insertAfter(g);k.click(function(){return e.toggleClass("toggled-children"),a(c).toggle(),g.toggle(),e.hasClass("toggled-children")?a(this).html("&#9650;").addClass("open"):(a(this).html("&#9660;").removeClass("open"),b.makeFloatedChildrenCollapsible()),!1}),e.hasClass("toggled-children")&&(e.removeClass("toggled-children"),k.triggerHandler("click"))})},f.prototype.addArticle=function(a,b){this.$elem.find(".articles").append(a.$elem),a.listID=this.data.id,g.trigger("Arlima.articleAdded",a),b&&this.toggleUnsavedState(!0)},f.prototype.preview=function(){b.ArlimaListPreview.preview(this)},f.prototype.setData=function(b){this.data=b;var d=b.title,e=this.$elem.find(".header .title");a.trim(e.text())!=d&&e.text(d),(c.isAdmin||c.allowEditorsCreateSections)&&b.options.supports_sections&&!b.isImported?this.$elem.find(".add-section").show():this.$elem.find(".add-section").hide(),h(this)},f.prototype.toggleUnsavedState=function(a){if(a=a===!0,a!=this._isUnsaved){this._isUnsaved=a;{var b=this.$elem.find(".header .title");this.$elem.find(".previous-versions li.future")}b.find(".dot").remove(),this._isUnsaved?(this.$elem.addClass("unsaved"),b.prepend('<span class="dot pulse">&nbsp;</span>'),this.$elem.find(".previous-versions .future.save").removeClass("disabled"),this.displayTitleMessage(!1)):(this.$elem.removeClass("unsaved"),this.$elem.find(".previous-versions .future.save").addClass("disabled"))}},f.prototype.toggleAjaxPreLoader=function(a){i(this,a)},f.prototype.deleteScheduledVersion=function(c){var d=this,e=this.data.version.id==c;b.ArlimaListLoader.deleteScheduledVersion(c,function(){e?d.reload():(a.each(d.data.scheduledVersions,function(a,b){return b.id==c?(d.data.scheduledVersions.splice(a,1),!1):void 0}),h(d))})},f.prototype.reload=function(a,c){var d=this;this.loadedVersion=a,e.log("Reloading list "+this+" with version "+a),b.ArlimaArticleForm.isEditing(this.data.id)&&b.ArlimaArticleForm.clear();var f=a&&a!=this.data.version.id?!0:!1;i(this,!0),b.ArlimaListLoader.load(this,function(){i(d,!1),d.makeFloatedChildrenCollapsible(),3==d.data.version.status?(f=!1,d._hasLoadedScheduledVersion=!0,d.displayTitleMessage(!1)):d._hasLoadedScheduledVersion=!1,d.data.versions[0]&&d.loadedVersion!=d.data.versions[0].id||(f=!1),d.toggleUnsavedState(f),"function"==typeof c&&c(d)},a)},f.prototype.hasUnsavedChanges=function(){return this._isUnsaved},f.prototype.hasLoadedScheduledVersion=function(){return this._hasLoadedScheduledVersion},f.prototype.fixFutureNotices=function(){this.$elem.find(".future").each(function(){this.arlimaArticle&&this.arlimaArticle.isPublished()&&this.arlimaArticle.updateItemPresentation()})},f.prototype.article=function(a){return this.$elem.find(".article").get(a).arlimaArticle},f.prototype.dump=function(){this.$elem.find(".article").each(function(){e.log(this.arlimaArticle)})},f.prototype.save=function(a){var e=this,f=function(c){i(e,!1),c&&(e.loadedVersion=c.loadedVersion,e.data.version=c.version,e.data.versions=c.versions,e.data.versionDisplayText=c.versionDisplayText,e.data.scheduledVersions=c.scheduledVersions,e.data.version.scheduled=parseInt(e.data.version.scheduled,10),e._hasLoadedScheduledVersion=a?!0:!1,b.ArlimaArticleForm.isEditing(e.data.id)&&b.ArlimaArticleForm.toggleUnsavedState("saved"),h(e))};if(this.hasUnsavedChanges())if(this.toggleUnsavedState(!1),i(this,!0),this.hasLoadedScheduledVersion())d.updateListVersion(this.data.id,this.data.version.id,this.getArticleData(),function(){i(e,!1),b.ArlimaArticleForm.isEditing(e.data.id)&&b.ArlimaArticleForm.toggleUnsavedState("saved")});else{delete this.loadedVersion;var g="";a&&(g=Math.round(a.getTime()/1e3)),d.getLaterVersion(this.data.id,this.data.version.id,function(a){if(a){var d=!0;a.version&&!g&&(d=confirm(c.lang.laterVersion+" \r\n "+a.versioninfo+"\r\n"+c.lang.overWrite)),e.$elem.find(".streamer-extra").length>1&&(d=confirm(c.lang.severalExtras+"\r\n"+c.lang.overWrite)),d?b.ArlimaListLoader.save(e,g,f):i(e,!1)}})}},f.prototype.updateParentProperties=function(){var a=[-1,-1,-1,-1,-1];this.$elem.find(".article").each(function(b){var c;try{c=parseInt(this.className.match(/list-item-depth-(\d+)/)[1],10)}catch(d){c=0}a[c]=b,this.arlimaArticle.data.parent=c>0?a[c-1]:"-1",this.arlimaArticle.children=[]}),this.updateSecondLevelArticleClasses()};var h=function(d){if(d.data.isImported)d.$elem.find(".version .number").text(d.data.versionDisplayText);else{var e=d.$elem.find(".version .number"),f=d.$elem.find(".previous-versions"),g=d.loadedVersion||d.data.version.id,h=d.data.scheduledVersions.length>0;e.html("v. "+g).attr("title",d.data.versionDisplayText).qtip({position:{my:"right top",at:"center left",viewport:jQuery(b)},style:b.qtipStyle}),3==d.data.version.status?j(d):(d.$elem.removeClass("scheduled"),d.$elem.find(".header .title").removeClass("scheduled").find(".schedule-clock").remove()),f.html("");var i=a("<li></li>",{"class":"future save"}).text(c.lang.saveFutureVersion).prepend('<i class="fa fa-save">&nbsp;</i>').toggleClass("disabled",!d.hasUnsavedChanges()).on("click",function(){return a(this).hasClass("disabled")?!1:(a("#arlima-schedule-modal").attr("data-list",d.data.id),void a.fancybox({href:"#arlima-schedule-modal",height:400,width:300}))});f.append(i);var k=a("<li></li>",{"class":"separator"}).text(c.lang.scheduledVersions);h&&f.append(k),a.each(d.data.scheduledVersions,function(b,e){var h=new Date(1e3*e.scheduled),i="0"+h.getHours(),j="0"+h.getMinutes(),k=a("<li></li>").attr("data-version",e.id).addClass(e.id==g?"selected":"").text(c.lang.toPublish+" "+h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+i.substr(i.length-2)+":"+j.substr(j.length-2)),l=a("<a>&times;</a>").attr("href","#").attr("class","delete").attr("title",c.lang["delete"]).on("click",function(b){var e=a(b.target).parent(),f=confirm(c.lang.confirmDeleteVersion);return f&&d.deleteScheduledVersion(e.attr("data-version")),!1});f.append(k.append(l))});var l=k.clone(!0);l.text(c.lang.publishedVersions),f.append(l),a.each(d.data.versions,function(b,c){var e=a("<li></li>").attr("data-version",c.id).addClass(c.id==g?"selected":"").text("#"+c.id+" ("+c.saved_by+")");f.append(e),3==d.data.version.status&&(b>0?e.addClass("disabled"):e.click(function(){return d.reload(),!1}))})}},i=function(a,b){var c=a.$elem.find(".ajax-loader");b?(c.show(),a.$elem.find(".footer a").addClass("disabled")):(a.$elem.find(".footer a").removeClass("disabled"),c.hide())},j=function(b,d){d||(d=b.$elem.find(".header .title")),d.addClass("scheduled").find("i").remove(),a("<i>&nbsp;</i>").attr("class","fa fa-clock-o schedule-clock").attr("title",c.lang.scheduledVersions).attr("alt",c.lang.scheduledVersions).prependTo(d),b.$elem.addClass("scheduled")},k=function(a){return'<div id="arlima-list-'+a.id+'" data-list-id="'+a.id+'" class="article-list"><div class="header"><span><a href="#" class="remove">&times;</a><a href="#" class="add-section">+</a><span class="title"></span><span class="schedule-notice notice"></span></span></div><div class="articles"></div><div class="footer"><a href="#" class="preview" title="'+c.lang.preview+'"><i class="fa fa-eye"></i></a><a href="#" class="save" title="'+c.lang.publish+'"><i class="fa fa-save"></i></a><img src="'+c.pluginURL+'/images/ajax-loader-trans.gif" class="ajax-loader" /><a href="#" class="refresh" title="'+c.lang.reload+'"><i class="fa fa-refresh"></i></a><div class="version"><div class="number"></div><ul class="previous-versions"></ul></div></div></div>'
},l=function(a,b,d){var f=!0;a.hasUnsavedChanges()&&!e.hasMetaKeyPressed(b)&&(f=confirm(c.lang.hasUnsavedChanges)),f&&a.reload(d)},m=function(c){if(c.$elem.find(".refresh").click(function(a){return l(c,a),!1}),c.$elem.find(".preview").click(function(){return c.data.isImported||c.preview(),!1}),c.$elem.find(".save:eq(0)").click(function(){return c.save(),!1}),c.$elem.find(".remove").click(function(a){return b.ArlimaListContainer.remove(c,a),!1}),c.$elem.find(".add-section").click(function(){var a={title:"Section divider "+(c.numSections()+1),options:{sectionDivider:1}};c.addArticle(new ArlimaArticle(a),!0);var b=c.$elem.find(".articles");return b.scrollTop(b.innerHeight()),!1}),!c.data.isImported){var d=c.$elem.find(".version"),e=a("#arlima-schedule-modal"),f=!1,g=c.$elem.find(".previous-versions"),h=function(){d.find(".number").removeClass("active"),g.hide()};g.bind("mouseenter",function(){f=!0}).bind("mouseleave",function(){f=!1,setTimeout(function(){g.parent().is(":visible")&&!f&&h()},1200)}).bind("click",function(b){a(b.target).is(".future, .disabled, .schedule")||l(c,b,a(b.target).attr("data-version"))}),d.find(".number").click(function(){return a(this).hasClass("active")?(h(),!1):(a(this).addClass("active"),g.show(),f=!0,!1)}),e.find("button.schedule").unbind("click").click(function(){var c=e.find("#schedule-date").val().split("-"),d=e.find("#schedule-time").val().split(":"),f=new Date,g=e.attr("data-list"),h=new Date;return c=a.map(c,function(a){return parseInt(a,10)}),d=a.map(d,function(a){return parseInt(a,10)}),f.setFullYear(c[0],c[1]-1,c[2]),f.setHours(d[0]),f.setMinutes(d[1]),f.getTime()>h.getTime()?(b.ArlimaListContainer.list(g).save(f),e.find(".message").addClass("hidden"),a.fancybox.close()):e.find(".message").removeClass("hidden"),!1})}};return f}(jQuery,window,ArlimaJS,ArlimaBackend,ArlimaUtils),ArlimaArticle=function(a,b,c,d){function e(b,c,d,g){this.$elem=d?d:a(f),g===!1&&this.$elem.find(".remove").remove(),a.isArray(b.options)&&(b.options=a.extend({},b.options)),this.setData(a.extend(!0,{},e.defaultData,b)),this.listID=c,this.$elem[0].arlimaArticle=this,this.$elem.attr("title",new Date(1e3*b.published)),this.addClickEvents(g)}var f='<div class="article"><div class="article-title-container"><span class="article-title"></span><a href="#" class="remove">&times;</a></div><div class="children-transport"></div></div>';e.isArticleObj=function(a){return a.$elem&&a.$elem.arlimaArticle&&a==a.$elem.arlimaArticle},e.prototype.addClickEvents=function(e){var f=this,g=this.$elem.find(".remove");this.$elem.unbind("click").click(function(){b.ArlimaArticleForm.edit(f)}),0==g.length&&e&&(g=a('<a href="#" class="remove">&times;</a>').appendTo(this.$elem.find(".article-title-container"))),g.unbind("click").click(function(a){var b=c.lang.wantToRemove+f.$elem.find(".article-title").text()+c.lang.fromList;return(d.hasMetaKeyPressed(a)||confirm(b))&&f.remove(),a.stopPropagation(),!1})},e.prototype.setState=function(a){var b=this.getWrappedChildElem();"editing"==a?(this.$elem.addClass("editing"),b&&b.addClass("editing")):(this.$elem.removeClass("editing"),b&&b.removeClass("editing"))},e.prototype.setData=function(a){g(a,this.data)?(this.data=a,this.updateItemPresentation()):(this.data=a,this.isPublished()?this.$elem.removeClass("future"):this.$elem.addClass("future"))},e.prototype.updateItemPresentation=function(){var b="",c="",d=this;this.data.title?b=this.data.title.replace(/__/g,""):this.data.content&&(b+="["+this.data.content.replace(/(<.*?>)/gi,"").substring(0,30)+"...]"),this.opt("preTitle")&&(b=this.opt("preTitle")+" "+b);var e=[{classPrefix:"format-",attr:"data-format-class",opt:"format"},{classPrefix:"template-",attr:"data-template-class",opt:"template"}];if(a.each(e,function(a,b){var c=d.$elem.attr(b.attr),e=b.classPrefix+d.opt(b.opt),f=c!=e;f&&d.opt(b.opt)?(c&&d.$elem.removeClass(c),d.$elem.addClass(e).attr(b.attr,e)):c&&f&&d.$elem.removeAttr(b.attr).removeClass(c)}),c=b,this.opt("sectionDivider"))this.$elem.addClass("section-divider"),c="&ndash;&ndash;&ndash; "+c+" &ndash;&ndash;&ndash;","text"==this.opt("streamerType")?(this.$elem.css("background","#"+this.opt("streamerColor")),h(this.opt("streamerColor"))?this.$elem.addClass("light-streamer"):this.$elem.removeClass("light-streamer")):this.$elem.css("background","");else if(this.opt("streamerType")){var f;switch(this.opt("streamerType")){case"extra":f="rgba(0,0,0, .5)";break;case"image":f="rgba(0,0,0, .5)";break;default:f="#"+this.opt("streamerColor")}"#"==f&&(f="black"),c='<span class="streamer-indicator" style="background:'+f+'"></span> '+c}this.opt("adminLock")&&(c='<span class="fa fa-lock"></span>'+c),this.opt("scheduled")&&(c='<span class="fa fa-clock-o"></span>'+c),this.opt("fileInclude")&&(c='<span class="fa fa-bolt"></span>'+c),this.isPublished()?this.$elem.removeClass("future"):(c='<span class="future-push-date">'+i(1e3*this.data.published)+"</span>"+b,this.$elem.addClass("future")),this.$elem.find(".article-title").html(c);var g=this.getWrappedChildElem();g&&g.text(b)},e.prototype.getWrappedChildElem=function(){var b=!1,c=this;if(this.$elem.hasClass("contains-toggled-children"))b=this.$elem.find(".article-children").children().eq(0);else if(this.isWrappedChild()){var d=this.getParentArticle().$elem.find(".article-children").children();d.each(function(){return this.arlimaArticle==c?(b=a(this),!1):void 0})}return b},e.prototype.isPublished=function(){return!d.isFutureDate(1e3*this.data.published)},e.prototype.isChild=function(){return parseInt(this.data.parent,10)>-1},e.prototype.remove=function(){var d=!1,e=b.ArlimaListContainer.list(this.listID);return this.opt("adminLock")&&!c.isAdmin?void alert(c.lang.adminLock):(b.ArlimaArticleForm.isEditing(this.$elem)?b.ArlimaArticleForm.clear():this.isChild()&&(d=b.ArlimaArticlePreview.isPreviewed(this)),a.each(this.getChildArticles(),function(a,b){b.remove()}),this.$elem.remove(),d&&b.ArlimaArticlePreview.reload(),e.toggleUnsavedState(!0),e.updateParentProperties(),void e.$elem.trigger("change"))},e.prototype.isWrappedChild=function(){return this.$elem.hasClass("list-item-depth-2")&&this.getParentArticle().$elem.find(".article-children").is(":visible")},e.prototype.getChildArticles=function(){if(this.isWrappedChild())return[];var a=[],b=this.$elem.next(),c=b.length&&b[0].arlimaArticle?b[0].arlimaArticle.data.parent:-1,d=this.isChild()&&!this.isWrappedChild();if(c>-1&&c!=this.data.parent)for(;b.length&&(b[0].arlimaArticle.data.parent!=c||void 0!==b[0].arlimaArticle.data.options.inlineWithChild&&!d||a.push(b[0].arlimaArticle),-1!=b[0].arlimaArticle.data.parent);)b=b.next();return a},e.prototype.isParent=function(){if("-1"==this.data.parent){var a=this.$elem.next(),b=a.length&&a[0].arlimaArticle?a[0].arlimaArticle.data.parent:-1,c=this.isChild()&&!this.isWrappedChild();if(b>-1&&b!=this.data.parent)for(;a.length;){if(a[0].arlimaArticle.data.parent==b&&(void 0===a[0].arlimaArticle.data.options.inlineWithChild||c))return!0;if(-1==a[0].arlimaArticle.data.parent)break;a=a.next()}}return!1},e.prototype.getTemplate=function(){var a=this.opt("template");return a||(this.listID?a=b.ArlimaListContainer.list(this.listID).data.options.template:(d.log("Trying to get template of an article that is not yet related to any list","warn"),a=void 0)),a},e.prototype.getParentArticle=function(){if(this.isChild()){var a=this.$elem.parent().find(".article");return a.get(this.data.parent).arlimaArticle}},e.prototype.opt=function(a){return this.data.options[a]||""},e.prototype.canPreview=function(){return!this.opt("fileInclude")&&!this.opt("sectionDivider")},e.prototype.canHaveTemplate=function(){return this.opt("sectionDivider")?c.sectionDivsSupportTemplate:!this.opt("fileInclude")},e.prototype.canHaveChildren=function(){return this.canPreview()},e.prototype.isDivider=function(){return this.opt("sectionDivider")},e.prototype.canBeChild=function(){return!this.isDivider()&&!this.isParent()};var g=function(a,b){return!b||a.title!=b.title||a.options.preTitle!=b.options.preTitle||a.options.format!=b.options.format||a.options.adminLock!=b.options.adminLock||a.options.scheduled!=b.options.scheduled||a.options.streamerColor!=b.options.streamerColor||a.options.streamerType!=b.options.streamerType},h=function(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16);return b+c+d>382},i=function(a){var b=function(a){return a.getYear()+"-"+a.getMonth()+"-"+a.getDate()},c=function(a){return 10>a?"0"+a:a},d=new Date,e=new Date(a);return b(d)==b(e)?c(e.getHours())+":"+c(e.getMinutes()):c(e.getMonth()+1)+"/"+c(e.getDate())};return e}(jQuery,window,ArlimaJS,ArlimaUtils),ArlimaArticlePreview=function(a,b,c,d){"use strict";var e=a(document),f=!1,g={article:null,$iframe:null,$iframeBody:null,isRendered:!1,$elem:!1,templateContent:null,titleElem:null,lastHeightChange:null,width:null,iframesCount:null,setArticle:function(a,b,c,e,f){d.log("Adding article to preview for "+a.data.id),this.article=a,this.width=c;var g=r();this.width instanceof Array?(this.$elem.find("iframe").eq(0).width(c[0]),this.iframesCount=this.width.length,this.$elem.css({maxHeight:"800px",overflow:"scroll"})):(this.$elem.find("iframe").eq(0).width(c),this.iframesCount=1),!a.canPreview()||f?this.isVisible()&&this.hide():(this.titleElem=e||"h2",this.setTemplate(b),s(g))},setTemplate:function(a){this.templateContent=h(a),this.lastHeightChange=null,this.isVisible()?this.$elem.find("iframe").animate({opacity:0},"fast",function(){j(!0),g.$elem.find("iframe").animate({opacity:1},"fast")}):this.isRendered=!1},reload:function(){var a=b.ArlimaTemplateLoader.templates[this.article.getTemplate()];this.setArticle(this.article,a,this.width,this.titleElem)},update:function(b){if(this.isRendered){var c={streamer:["options:streamerType","options:streamerColor","options:streamerContent"],title:["options:preTitle","title","size"],post:["post"],content:["content"],format:["options:format"],imageSource:["image:attachment"],imageSettings:["image:size","image:alignment"]},d=b.attr("data-prop");a.each(c,function(b,c){var e=!1;return a.each(c,function(a,c){return c==d?(e=!0,l(b),!1):void 0}),e?!1:void 0})}},isPreviewed:function(b){var c=!1;if(this.article)if(this.article.isChild()&&this.article.getParentArticle().$elem[0]==b.$elem[0])c=!0;else if(this.article.$elem[0]==b.$elem[0])c=!0;else if(b.isChild()){var d=[],e=b.getParentArticle().getParentArticle()||b.getParentArticle(),f=function(b){a.each(b.getChildArticles(),function(a,b){d.push(b),f(b)})};f(e),a.each(d,function(a,d){return d.$elem[0]==b.$elem[0]?(c=!0,!1):void 0})}return c},isVisible:function(){return this.$elem.is(":visible")&&(!f||"in"==f)},show:function(){if(!f&&(f="in",!this.article.opt("sectionDivider"))){var a=r(),b=function(){g.$elem.css({width:0,marginLeft:"-20px"}).show().animate({width:a.elemWidth,marginLeft:"-"+(a.leftMargin+20)+"px"},"normal",function(){f=!1})};g.isRendered?b():(e.one("previewUpdate",function(){setTimeout(function(){g.$elem.show(),i(),b()},200)}),j())}},hide:function(){f||(f="out",this.$elem.find("iframe").each(function(){var b=a(this),c=b.width();b.attr("data-default-width",c).width(c)}),this.$elem.animate({width:0,marginLeft:"-20px",opacity:0},"normal",function(){f=!1,g.$elem.css({display:"none",opacity:1}),s(r()),g.$elem.find("iframe",function(){a(this).width(a(this).attr("data-default-width"))})}))},toggle:function(){this.isVisible()?this.hide():this.show()},init:function(c){this.$elem=c,c.html('<iframe name="arlima-preview-iframe" id="arlima-preview-iframe" scrolling="no" border="0" frameborder="0"></iframe>'),this.$iframe=this.$elem.find("iframe").contents(),"arlimaTemplateStylesheets"in b&&a.each(b.arlimaTemplateStylesheets,function(a,b){g.$iframe.find("head").append('<link rel="stylesheet" type="text/css" href="'+b+'" />')}),this.$iframe.find("html,body").css({border:0,padding:0,margin:0,overflow:"hidden"}).addClass("arlima-preview"),this.$iframeBody=this.$iframe.find("body")},getContentElement:function(){return this.$iframeBody.find(".template-placeholder-content").eq(0)},getTitleElement:function(){return this.$iframeBody.find(".template-placeholder-title").eq(0)}},h=function(a){return a.replace("{{{html_image}}}",'<span class="template-placeholder-image">{{{html_image}}}</span>').replace("{{{html_title}}}",'<span class="template-placeholder-title">{{{html_title}}}</span>').replace("{{title}}",'<span class="template-placeholder-title-plain">{{title}}</span>').replace("{{{html_content}}}",'<span class="template-placeholder-content">{{{html_content}}}</span>').replace("{{{content}}}",'<span class="template-placeholder-content-plain">{{{content}}}</span>').replace("{{class}}","template-placeholder-format {{class}}").replace("{{{html_streamer}}}",'<span class="template-placeholder-streamer">{{{html_streamer}}}</span>')},i=function(a){var b;d.log("Updating iframe height");for(b in g.$iframeBody){var c=g.$iframeBody.eq(b).children().eq(0).outerHeight(!0);c||(c=400),a?g.$elem.find("iframe").eq(b).animate({height:c+"px"},"fast"):g.$elem.find("iframe").eq(b).css("height",c+"px")}},j=function(c){d.log("Rendering preview");var f,h,j=[];g.isRendered=!0,g.$iframeBody.html("");try{if(g.article.isChild()){var l=g.article.getParentArticle();l.isChild()&&(l=l.getParentArticle()),f=k(l,!1,!1)}else f=k(g.article,g.templateContent),f.eq(0).addClass("main-article-preview");var m=function(){i(c)},n=setTimeout(m,250);if(f.find("img").bind("load",function(){i(c),clearTimeout(n)}),f.appendTo(g.$iframeBody),g.iframesCount>1&&g.$iframe.length<g.width.length){for(j.push(g.$iframeBody[0]),h=g.$iframe.length;h<g.width.length;h++){g.$elem.append('<div class="iframe-wrapper"><iframe name="arlima-preview-iframe" id="arlima-preview-iframe-'+h+'" style="width: '+g.width[h]+'px;" scrolling="no" border="0" frameborder="0"></iframe></div>');var o=g.$elem.find("#arlima-preview-iframe-"+h).contents();"arlimaTemplateStylesheets"in b&&a.each(b.arlimaTemplateStylesheets,function(a,b){o.find("head").append('<link rel="stylesheet" type="text/css" href="'+b+'" />')}),o.find("html,body").css({border:0,padding:0,margin:0,overflow:"hidden"}).addClass("arlima-preview"),o.find("body").html(jQuery("<div />").append(f.clone()).html()),j.push(o.find("body")[0])}g.$iframe=g.$elem.find("iframe"),g.$iframeBody=a(j)}else if(g.$iframe.length>g.iframesCount)for(h=g.iframesCount;h<g.$iframe.length;h++)g.$iframeBody.eq(h).remove(),g.$iframe.eq(h).remove(),g.$iframeBody.splice(h,1),g.$iframe.splice(h,1);e.trigger("previewUpdate","all")}catch(p){d.log(p)}},k=function(d,e,f,h,i){if(!e&&(e=b.ArlimaTemplateLoader.templates[d.getTemplate()],!e))return alert("Use of template that does not exist "+d.getTemplate()),h?"":a("<div></div>");if(-1==e.indexOf("{{class}}"))return alert("Use of template that is missing {{class}} variable"),h?"":a("<div></div>");if(-1==e.indexOf('data-post="{{post}}"'))return alert('Use of template that is missing attribute data-post="{{post}}"'),h?"":a("<div></div>");var j=a.extend(!0,{},d.data);if(j.html_title=m(d),j.html_content=q(d),j.html_streamer=o(d),j["class"]=n(d),j.html_image=p(d),j.child_articles="",i&&(j["class"]+=i),!f&&e.indexOf("{{{child_articles}}}")>-1){var l="",r="",s=!1,t=d.getChildArticles();a.each(t,function(b,c){r="";var d=c.getChildArticles();return d.length?(d.unshift(c),l+='<div class="arlima child-wrapper child-wrapper-'+d.length+'">',a.each(d,function(a,b){0==a?r="first":a==d.length-1&&(r="last"),l+=b==g.article?k(b,g.templateContent,!0,!0,r+" teaser-child teaser-split"):k(b,!1,!0,!0,r+" teaser-child teaser-split")}),void(l+="</div>")):void(l+=c==g.article?k(c,g.templateContent,!0,!0,r+" teaser-child"):k(c,!1,!0,!0,r+" teaser-child"))}),s&&(l+="</div>"),j.child_articles='<div class="teaser-children children-'+t.length+'">'+l+"</div>"}var u=c.render(e,j);return h?u:a(u)},l=function(c){if("imageSource"==c||"post"==c)return void g.reload();if("imageSettings"==c){var d=g.$iframeBody.find(".template-placeholder-image img");d.length>0&&(d.removeClass("alignright alignleft half third quarter fifth sixth"),d.addClass(g.article.data.image.alignment),d.addClass(g.article.data.image.size),g.$iframeBody.find(".template-placeholder-format").addClass(n(g.article)))}else if("format"==c){var f=g.$iframeBody.find(".template-placeholder-format"),h=g.article.opt("format");a.each(b.ArlimaArticleForm.$form.find(".formats option"),function(){f.removeClass(a(this).attr("value"))}),h&&f.addClass(h)}else{var j,k="";switch(c){case"title":j=m(g.article),k=g.article.data.title;break;case"content":j=q(g.article),k=g.article.data.content;break;case"streamer":j=o(g.article)}g.$iframeBody.find(".template-placeholder-"+c).html(j),g.$iframeBody.find(".template-placeholder-"+c+"-plain").html(k)}("streamer"==c||"imageSettings"==c)&&g.$iframeBody.find(".template-placeholder-format").removeClass("img-full img-half img-third img-fourth img-fifth img-sixth no-img has-streamer no-streamer").addClass(n(g.article)),e.trigger("previewUpdate",[c]),i()},m=function(a){if(a.data.title){var b=a.data.title.replace("__","<br />"),c=a.opt("preTitle");return c&&(b='<span class="arlima-pre-title">'+c+"</span> "+b),"<"+g.titleElem+' style="font-size:'+a.data.size+'px">'+b+"</"+g.titleElem+">"}return""},n=function(a){var b=["teaser"];return b.push(a.data.image&&a.data.image.attachment?"img-"+a.data.image.size:"no-img"),b.push(a.opt("streamerType")?"has-streamer":"no-streamer"),a.opt("format")&&b.push(a.opt("format")),b.join(" ")+" "},o=function(a){return"text"==a.opt("streamerType")?'<div class="streamer text color-'+a.opt("streamerColor")+'" style="background: #'+a.opt("streamerColor")+'">'+a.opt("streamerContent")+"</div>":"extra"==a.opt("streamerType")?'<div class="streamer extra">Extra</div>':"image"==a.opt("streamerType")?'<div class="streamer image"><img src="'+a.opt("streamerContent")+'" alt="" /></div>':""!=a.opt("streamerContent")?'<div class="streamer '+a.opt("streamerType")+'">'+a.opt("streamerContent")+"</div>":""},p=function(a){return a.data.image&&a.data.image.url?'<img src="'+a.data.image.url+'" class="arlima-preview-img '+a.data.image.size+" "+a.data.image.alignment+'" />':""},q=function(b){if(""!=b.data.content){var c=a.trim(b.data.content);return 0!==b.data.content.indexOf("<p")&&(c="<p>"+c+"</p>"),c}return""},r=function(){var a={};return g.width instanceof Array?(a.elemWidth=g.width[0]+20,a.leftMargin=Math.max.apply(Math,g.width)+20):(a.elemWidth=g.width,a.leftMargin=g.width),a},s=function(a){g.$elem.css({width:a.elemWidth+"px",marginLeft:"-"+(a.leftMargin+20)+"px"})};return g}(jQuery,window,Mustache,ArlimaUtils,ArlimaJS),ArlimaArticleForm=function(a,b,c,d,e,f,g){var h=a(document),i={article:!1,state:"saved",$form:!1,$formInputs:!1,$streamerContainer:!1,$streamerButton:!1,$controls:!1,$fileIncludeContainer:!1,edit:function(a){if(b._removeSliderKeyDownEvent(),this.$form.is(":visible")||this.$form.parent().find(".collapse-toggle").trigger("click"),!this.isEditing(a.$elem)){this.article&&this.article.setState("default"),b.ArlimaListContainer.showAsActive(a.listID),this.article=a,a.setState("editing");var c=b.ArlimaListContainer.list(a.listID);this.$controls.find("a").not(".save").removeClass("disabled"),this.toggleUnsavedState(c.hasUnsavedChanges()?"unsaved":"saved"),a.canPreview()||this.$controls.find(".preview").addClass("disabled"),b.ArlimaVersionManager.setArticle(a),this.setupForm(c)}},setupForm:function(h){if(f.clear(),d.log("Setting up article form for "+this.article.data.id),h||(h=b.ArlimaListContainer.list(this.article.listID)),this.$formInputs.val("").each(function(){var b,c=a(this),e=c.attr("data-prop");if(e.indexOf(":")>0){var f=e.split(":");b=f[0]in i.article.data?i.article.data[f[0]][f[1]]||"":""}else b=i.article.data[e]||"";if("SELECT"==this.nodeName)try{d.selectVal(c,b)}catch(g){"options:template"!=e?d.log(g.message,"error"):delete i.article.data.options.template}else c.val(b)}),b.ArlimaImageManager.setup(this.article),b.ArlimaImageUploader.removeNotice(),this.toggleEditorFeatures(),h.data.isImported||this.opt("adminLock")&&!g.isAdmin?(b.ArlimaFormBlocker.removeBlockers(),b.ArlimaFormBlocker.toggleFormBlocker(!0,h.data.isImported?!1:g.lang.adminLock)):b.ArlimaFormBlocker.toggleFormBlocker(!1),this.opt("streamerType")&&d.selectVal(this.$streamerContainer.find(".streamer-type-select"),this.opt("streamerType"),!1),this.$streamerContainer.find(".image").remove(),this.updateStreamerInputsContainer(!0),this.$form.find(".font-size-slider").slider("value",this.article.data.size),j(this.article.data.content),this.opt("fileInclude")){var k=this.opt("fileInclude"),l=this.$form.find('input[data-prop="options:fileArgs"]'),m=b.ArlimaFileIncludes.getFormFieldsDefinition(k);a.each(l.val().split("&"),function(a,b){var c=b.split("=");c[0]in m&&(m[c[0]].value=c[1])}),this.$fileIncludeContainer.show(),this.$fileIncludeContainer.find(".file").text(k.split("/wp-content")[1]||k),f.addFields(m);var n=f.inputs();n.on("keyup change",function(){var b=[];n.each(function(){var c=a(this);b.push(c.attr("data-prop")+"="+c.val())}),i.change(l,b.join("&"),!0)})}else this.$fileIncludeContainer.hide();e.setup(this.article),b.ArlimaArticleConnection.setup(this.article),c.setArticle(this.article,b.ArlimaTemplateLoader.templates[this.article.getTemplate()]||'!! unknown template "'+this.article.getTemplate()+'"',h.data.previewWidth||468,!1,h.data.isImported)},opt:function(a){return this.article.opt(a)||""},clear:function(){b.ArlimaListContainer.showAsActive(!1),c.hide(),f.clear(),this.$form.is(":visible")&&this.$form.parent().find(".collapse-toggle").trigger("click"),this.$controls.find("a").addClass("disabled"),this.$formInputs.val(""),d.selectVal(this.$formInputs.filter("select"),""),j(""),this.state="saved",this.article&&this.article.$elem&&(this.article.setState("default"),this.article=!1),b.ArlimaVersionManager.clear()},updateStreamerInputsContainer:function(b){if(this.opt("streamerType")){this.$streamerContainer.show();var c=this.$streamerContainer.find(".content"),e=this.$streamerContainer.find(".image"),f=this.$streamerContainer.find("div:not(.streamer-images)");switch(this.opt("streamerType")){case"extra":this.change(c,"Extra",!0),c.hide(),f.hide(),e.remove();break;case"image":if(c.hide(),f.hide(),0==e.length){var h="["+g.lang.chooseImage+"]";d.isImagePath(this.opt("streamerContent"))?h='<img src="'+this.opt("streamerContent")+'" />':this.opt("streamerContent")&&this.change(c,""),e=a('<a href="#" class="image">'+h+"</a>").insertAfter(f.eq(0)),e.on("click",function(){return a.fancybox({autoScale:!0,transitionIn:"elastic",transitionOut:"elastic",speedIn:500,speedOut:300,autoDimensions:!0,centerOnScroll:!0,href:"#streamer-images"}),!1})}break;case"text":d.isImagePath(this.opt("streamerContent"))&&this.change(c,""),c.show(),e.remove(),f.show().css("background","#"+this.opt("streamerColor"));break;default:d.isImagePath(this.opt("streamerContent"))&&this.change(c,""),c.show(),e.remove(),f.hide()}b&&(this.$streamerButton.find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),this.$streamerButton.addClass("active"))}else this.$streamerContainer.hide(),b&&(this.$streamerButton.removeClass("active"),this.$streamerButton.find("i").removeClass("fa-check-square-o").addClass("fa-square-o"))},toggleEditorFeatures:function(){var c=b.ArlimaFormBlocker,d=b.ArlimaTemplateLoader.getTemplateSupport(this.article),e=this.$form.find(".template-feature");this.article.opt("sectionDivider")||this.article.opt("fileInclude")?(e.filter('[data-feature="image"]').hide(),e.filter('[data-feature="editor"]').hide(),e.filter('[data-feature="connection"]').hide(),c.toggleStreamerBlocker(!1),c.toggleImageAlignBlocker(!1),c.toggleTitleBlocker(!0),this.article.data.options.fileInclude&&(c.toggleStreamerBlocker(!0),e.filter('[data-feature="file-include"]').show())):(ArlimaListContainer.list(this.article.listID).data.isImported||c.removeBlockers(),e.show(),a.each(d,function(a,b){"imageSize"==a||b||(c.addBlocker(a)||e.filter('[data-feature="'+a+'"]').hide(),b||"image"!=a||c.toggleImageAlignBlocker(!1))}),d.image&&this.article.data.image&&"full"==this.article.data.image.size&&c.toggleImageAlignBlocker(!0))},serialize:function(){var b=a.extend(!0,{},this.article.data);return this.$formInputs.each(function(){var c=a(this),d=c.attr("data-prop");if(d)if(d.indexOf(":")>0){var e=d.split(":");e[0]in b||(b[e[0]]={}),b[e[0]][e[1]]=c.val()}else b[d]=c.val()}),b},isEditing:function(b){return this.article?a.isNumeric(b)?b==this.article.listID:ArlimaArticle.isArticleObj(b)?b==this.article:b[0].arlimaArticle&&b[0].arlimaArticle==this.article.$elem[0].arlimaArticle:!1},toggleUnsavedState:function(a){this.state=a,"saved"==this.state?this.$controls.find(".save").addClass("disabled"):(this.$controls.find(".save").removeClass("disabled"),b.ArlimaListContainer.list(this.article.listID).toggleUnsavedState(!0))},change:function(b,c,e){void 0===e&&(e=!0),"string"==typeof b&&(b=(b.indexOf("streamer")>-1?this.$streamerContainer:this.$form).find(b)),"SELECT"==b.get(0).nodeName?d.selectVal(b,c,e):(c=a.trim(c),b.val()!=c&&(b.val(c),e&&b.trigger("change")))},getEditorContent:function(){return j()},init:function(f,j){d.makeCollapsing(f,function(){i.$form.trigger(f.is(":visible")?"open":"closed")}),this.$form=f.find(".inside"),this.$streamerButton=f.find(".button.streamer"),this.$streamerContainer=f.find(".streamer-container"),this.$fileIncludeContainer=f.find(".file-include-container"),this.$controls=j,j.find(".save").click(function(){return"unsaved"==i.state&&(i.toggleUnsavedState("saved"),b.ArlimaListContainer.list(i.article).save()),!1}),j.find(".preview").click(function(){return a(this).hasClass("disabled")||c.toggle(),!1}),j.find(".preview-list").click(function(){return a(this).hasClass("disabled")||b.ArlimaListContainer.list(i.article.listID).preview(),!1});var k=f.find(".formats"),l=f.find(".templates"),m={};e.init(f.find("button.settings"),f.find(".settings-menu")),k.length>0&&e.addSelect(k),e.addSelect(l),e.addSelect(f.find(".scheduled-settings")),g.isAdmin&&e.addSelect(f.find(".admin-lock")),l.find("option").each(function(){m[a(this).attr("value")]=[]}),k.find("option").each(function(){var b=a(this).attr("value"),c=a(this).attr("data-template");c?a.each(c.split(","),function(a,c){c in m||(m[c]=[]),m[c].push(b)}):a.each(m,function(a){m[a].push(b)})}),e.templateFormatsMap=m;var n=!1,o=a(document),p=f.find("input.font-size"),q=function(b){var c=b.keyCode?b.keyCode:b.which;if(a.inArray(c,[39,37])>-1&&i.article){n=(new Date).getTime();var d=parseInt(p.val(),10);return d+=37==c?-1:1,s.slider("value",d),i.change(p,d),r(),!1}},r=function(){setTimeout(function(){(!n||(new Date).getTime()-5e3>n)&&_removeSliderKeyDownEvent()},5e3)},s=f.find(".font-size-slider").slider({value:18,min:8,max:100,slide:function(a,c){b.hasSliderFocus=!0,i.change(p,c.value)}}).mousedown(function(){b.hasSliderFocus=!0}),t=f.find(".ui-slider-handle");b._removeSliderKeyDownEvent=function(){n=!1,t.removeClass("active"),o.unbind("keydown",q)},f.find(".ui-slider-handle,input.font-size").bind("focus click",function(){t.addClass("active"),f.find("input").one("focus",_removeSliderKeyDownEvent),_removeSliderKeyDownEvent(),o.on("keydown",q),r(),n=(new Date).getTime()});var u=this.$streamerContainer.find(".streamer-type-select");this.$streamerButton.click(function(){i.$streamerButton.hasClass("active")?(i.$streamerButton.removeClass("active"),i.$streamerButton.find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),i.change(".streamer-type",""),i.change(i.$streamerContainer.find(".content"),""),i.$streamerContainer.find(".image").remove()):(i.$streamerButton.addClass("active"),i.$streamerButton.find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),"extra"==u.val()&&i.$streamerContainer.find(".content").val("Extra"),i.change(".streamer-type",u.val())),i.$streamerButton.blur(),i.updateStreamerInputsContainer(!1)}),u.bind("change",function(){i.change(".streamer-type",a(this).val()),i.updateStreamerInputsContainer(!1)}),f.find("select.streamer-color").colourPicker({ico:"",name:"apa",title:!1}),f.find(".streamer-images img").click(function(){var b=a(this);i.$streamerContainer.find(".image").html(b.clone()),a(".fancybox-close").trigger("click"),i.change(i.$streamerContainer.find(".content"),b[0].src)}),f.find("input").each(function(){"text"==this.type&&a(this).on("blur",function(){var b=this.value.replace(/<br(|\/| \/)>/gi,"__");b=a("<div></div>").html(b).text(),this.value=b})}),setTimeout(function(){f.find('input[name="options:streamerColor"]').attr("data-prop","options:streamerColor").addClass("data"),i.$formInputs=f.find(".data");var d=!1;i.$formInputs.bind("change",function(){var e,f=a(this);if(i.article&&(e=f.attr("data-prop"))){if(e.indexOf(":")>0){var g=e.split(":");(!i.article.data[g[0]]||a.isArray(i.article.data[g[0]]))&&(i.article.data[g[0]]={}),i.article.data[g[0]][g[1]]=f.val()}else i.article.data[e]=f.val();"saved"==i.state&&i.toggleUnsavedState("unsaved"),"options:template"==e?(b.ArlimaImageManager.setup(i.article),i.toggleEditorFeatures(),i.updateStreamerInputsContainer(),c.setTemplate(b.ArlimaTemplateLoader.templates[i.article.getTemplate()])):c.update(f),"text"==f.get(0).type&&"size"!=e?d=!0:(d=!1,b.ArlimaVersionManager.addVersion(i.article));var j=["options:preTitle","title","options:streamerType","options:format","options:streamerContent","options:streamerColor","options:template","options:adminLock","options:scheduled"];a.inArray(e,j)>-1&&i.article.updateItemPresentation(!1)}h.trigger("Arlima.articleChanged",i.article)}).bind("keyup",function(){var b=a(this),c=b.attr("data-prop"),d=c.split(":"),e="";1==d.length&&i.article.data[d[0]]?e=i.article.data[d[0]]:2==d.length&&i.article.data[d[0]]&&(e=i.article.data[d[0]][d[1]]||""),e!=b.val()&&b.trigger("change")}).bind("blur",function(){d&&a(this).attr("data-prop")&&b.ArlimaVersionManager.addVersion(i.article)})},500)}},j=function(a){return void 0===a?b.ArlimaTinyMCE.getEditorContent():void b.ArlimaTinyMCE.setEditorContent(a)};return i}(jQuery,window,ArlimaArticlePreview,ArlimaUtils,ArlimaArticleSettingsMenu,ArlimaFormBuilder,ArlimaJS),ArlimaArticleConnection=function(a,b,c,d){"use strict";var e=a(document),f={posts:{},currentPost:{},$fancybox:null,$elem:!1,$futureNotice:!1,article:!1,searchedPosts:{},isPublishedPost:!1,setup:function(b){this.article=b,this.isPublishedPost=b.isPublished();var c=[],h=function(b){a.each(b.getChildArticles(),function(a,b){h(b),b.data.post&&c.push(b.data.post)})};b.data.post&&c.push(b.data.post),h(b),0==c.length||1==c.length&&0==c[0]?(this.posts={},this.currentPost={},this.setupLinks()):g(c)?(this.currentPost=this.posts[b.data.post]||{},this.setupLinks()):d.getPost(c.join(","),function(a){if(!a.posts)throw new Error("Backend did not return a list of posts ("+c.join(",")+")");f.posts=a.posts,f.currentPost=a.posts[b.data.post]||{},f.setupLinks(),e.trigger("postLoaded",[a.posts])})},getConnectionLabel:function(){return this.currentPost.ID?this.currentPost.post_title:this.article.opt("overridingURL")},setupLinks:function(){var a=this.currentPost.ID?this.currentPost.url:this.article.opt("overridingURL"),c=this.getConnectionLabel();this.$fancybox.find(".connection").text(c),this.$elem.find(".url").attr("href",a).text(c),this.currentPost.ID?(this.$fancybox.find(".overriding-url").val(""),this.$fancybox.find(".container").hide().filter(".wp-post").show(),this.$fancybox.find(".button").removeClass("active").filter(".wp-post-btn").addClass("active")):(this.$fancybox.find(".overriding-url").val(a),this.$fancybox.find(".container").hide().filter(".overriding-url").show(),this.$fancybox.find(".button").removeClass("active").filter(".overriding-url-btn").addClass("active"),b.selectVal(this.$fancybox.find("select.target"),this.article.opt("target")||"")),this.isPublishedPost?this.$futureNotice.hide():this.$futureNotice.show()},init:function(d,g){this.$elem=d,this.$futureNotice=d.find(".future-notice").hide(),this.$fancybox=g,d.find(".url").click(function(){return""!=this.href&&"#"!=this.href&&window.open(this.href),!1}),d.find(".change").click(function(){return a.fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:500,speedOut:300,autoDimensions:!0,centerOnScroll:!0,href:"#article-connection"}),!1
}),this.$fancybox.find(".button").click(function(){var d=a(this);if(d.hasClass("save")){var g=f.$fancybox.find("input.overriding-url").val(),h=f.$fancybox.find("select.target").val();g!=c.$form.find("input.overriding-url").val()&&(f.currentPost={},c.change("input.post",""),c.change("input.overriding-url",g),f.$fancybox.find(".connection").text(g),f.article.data.published=Math.round((new Date).getTime()/1e3-10),f.$futureNotice.hide(),f.article.data.image&&f.article.data.image.connected&&delete f.article.data.image.connected,f.article.updateItemPresentation()),c.$form.find("input.overriding-url-target").val()!=h&&c.change("input.overriding-url-target",h),a(".fancybox-close").trigger("click"),f.$elem.find(".url").attr("href",g).text(g),f.setupLinks()}else if(d.hasClass("search-btn")){var i=a.trim(f.$fancybox.find("input.search").val());d.parent().css("opacity","0.5"),f.searchedPosts={},window.ArlimaBackend.queryPosts({search:i},function(g){d.parent().css("opacity","1");var h=f.$fancybox.find(".search-result");if(g.articles){var i="";a.each(g.articles,function(a,c){f.searchedPosts[c.post.ID]=c.post;var d=b.isFutureDate(1e3*c.data.published)?" <em>("+ArlimaJS.lang.future+")</em>":"";i+='<p><a href="#" data-post="'+c.data.post+'">'+c.post.post_title+"</a> "+d+"</p>"}),h.html(i),h.find("a").click(function(){var b=f.searchedPosts[a(this).attr("data-post")];return f.currentPost=b,f.posts[b.ID]=b,c.change("input.overriding-url",""),c.change("input.overriding-url-target",""),c.change("input.post",b.ID),f.$fancybox.find(".connection").text(b.post_title),f.$elem.find(".url").attr("href",b.url).text(b.post_title),f.article.data.published=b.published,f.article.updateItemPresentation(),f.article.isPublished()?f.$futureNotice.hide():f.$futureNotice.show(),f.setupLinks(),e.trigger("postLoaded",[f.posts]),a(".fancybox-close").trigger("click"),!1})}else h.html("<p>"+ArlimaJS.lang.nothingFound+"</p>")})}else d.hasClass("overriding-url-btn")?(d.siblings().removeClass("active"),d.addClass("active"),f.$fancybox.find(".container").hide().filter(".overriding-url").show()):d.hasClass("wp-post-btn")?(d.siblings().removeClass("active"),d.addClass("active"),f.$fancybox.find(".container").hide().filter(".wp-post").show()):b.log("Pushing button in fancybox that does not exist","error");return!1})}},g=function(b){var c=!0;return a.each(b,function(a,b){return b in f.posts?void 0:(c=!1,!1)}),c};return f}(jQuery,ArlimaUtils,ArlimaArticleForm,ArlimaBackend),ArlimaPostSearch=function(a,b,c,d,e){var f={$elem:!1,isSearching:!1,currentOffset:0,search:function(b){if(this.isSearching)return!1;void 0===b&&(b=0),this.currentOffset=b,g(this,!0);var h={offset:b};this.$elem.find("input,select").each(function(){this.name&&(this.type?"checkbox"==this.type&&a(this).is(":checked")?h[this.name]=this.value:"checkbox"!=this.type&&(h[this.name]=this.value):h[this.name]=a(this).val())});var i=this.$elem.find(".search-result"),j=i.find("tbody");return c.queryPosts(h,function(c){g(f,!1),c&&(j.html(""),i.show(),i.find(".previous").hide(),i.find(".next").hide(),0==c.articles.length?j.append('<tr><td colspan="3"><em>'+d.lang.noPostsFound+"...</em></td></tr>"):(a.each(c.articles,function(b,c){var f=e.isFutureDate(1e3*c.data.published)?" <em>("+d.lang.future+")</em>":"",g='<a href="'+c.post.edit_url+'" target="_blank" class="edit-post-link"><span class="fa fa-edit"></span></a>',h=a("<tr><td><div>"+g+c.post.post_title+f+"</div></td><td>"+c.post.display_author+"</td><td>"+c.post.post_date+"</td></tr>"),i=h.find("div").get(0);h.find("td").get(0).arlimaArticle=new ArlimaArticle(c.data),i.arlimaArticle=new ArlimaArticle(c.data),e.makeDraggable(a(i)),h.find("td").first().qtip({position:{corner:{target:"leftMiddle",tooltip:"rightMiddle"}},style:{name:"blue",tip:"rightMiddle"},content:{text:c.data.content}}),j.append(h)}),0==b?i.find(".previous").hide():i.find(".previous").show(),c.articles.length>=10&&i.find(".next").show()))}),!1},init:function(a){this.$elem=a,e.makeCollapsing(a),a.find("form").on("submit",function(){return f.search(0),!1}),a.find("tfoot .previous").on("click",function(){f.search(f.currentOffset-10)}),a.find("tfoot .next").on("click",function(){f.search(f.currentOffset+10)})}},g=function(a,b){a.isSearching=b,a.isSearching?(a.$elem.find(".ajax-loader").show(),a.$elem.find(".search-result").hide()):a.$elem.find(".ajax-loader").hide()};return f}(jQuery,window,ArlimaBackend,ArlimaJS,ArlimaUtils,ArlimaArticleForm),ArlimaListLoader=function(a,b,c){var d={load:function(a,d,e){var f;"object"==typeof a&&(f=a),c.loadListData(f?f.data.id:a,e||"",function(a){if(a&&a.exists){var c=!0;a.version&&!a.isImported&&(a.version.scheduled=parseInt(a.version.scheduled,10),e||!f||a.version.id!=f.data.version.id||f.hasUnsavedChanges()||(c=b.JSON.stringify(a.scheduledVersions||{})!=b.JSON.stringify(f.data.scheduledVersions||{}))),f?(e&&3!=a.version.status&&(a.loadedVersion=a.version.id,a.version=f.data.version),c&&f.setData(a)):f=new ArlimaList(a),c&&f.setArticles(a.articles),d(f)}else d(!1)})},save:function(a,b,d){c.saveList(a.data.id,a.getArticleData(),b,function(a){"function"==typeof d&&d(a)})},deleteScheduledVersion:function(a,b){c.deleteScheduledVersion(a,function(a){"function"==typeof b&&b(a)})},addListToContainer:function(a){if(a){var c=b.ArlimaListContainer;a in c.lists?(c.focus(c.lists[a]),ArlimaUtils.shake(c.lists[a])):d.load(a,function(b){if(!b)throw new Error("Trying to add list "+a+" to container but it does not exist");c.add(b,{left:"25px",top:"25px",width:"300px",height:"400px"})})}},init:function(b){var c=b.find("select");b.find(".action").click(function(){this.blur();c.val();d.addListToContainer(c.val())}),e(b.find(".list-search input"),b.find(".list-search ul")),b.find(".list-search .list").on("click",function(){d.addListToContainer(a(this).attr("data-alid"))})}};a.expr[":"].Contains=function(b,c,d){return a(b).text().toUpperCase().indexOf(d[3].toUpperCase())>=0};var e=function(b,c){return c.hide(),b.keyup(function(b){var d=b.keyCode?b.keyCode:b.which;"13"==d&&b.preventDefault();var e=a.trim(a(this).val());if(e.length>0){var f=c.children().filter(":Contains('"+e+"')").show().length;f&&(c.children().not(":Contains('"+e+"')").hide(),c.show())}else c.hide()}).blur(function(){setTimeout(function(){c.hide()},500)}).focus(function(){a(this).trigger("keyup")})};return d}(jQuery,window,ArlimaBackend,ArlimaJS),ArlimaFormBlocker=function(a,b,c){var d={$formBlocker:!1,$streamerBlocker:!1,$preTitleBlocker:!1,$titleSizeBlocker:!1,$imgAlignBlocker:!1,toggleImageAlignBlocker:function(a){a?(this.$imgAlignBlocker.css({top:b.ArlimaImageManager.$alignButtons.eq(0).position().top-10+"px"}),this.$imgAlignBlocker.show()):this.$imgAlignBlocker.hide()},toggleFormBlocker:function(b,c){b?(c&&a('<div class="block-message">'+c+"</div>").appendTo(this.$formBlocker),this.$formBlocker.show(),d.updateFormBlockerSize(),setTimeout(function(){d.updateFormBlockerSize()},500)):(this.$formBlocker.hide(),this.$formBlocker.find(".block-message").remove())},updateFormBlockerSize:function(){this.$formBlocker.css({width:c.$form.parent().outerWidth()+20,height:c.$form.parent().outerHeight()+c.$controls.outerHeight()})},toggleStreamerBlocker:function(a){if(a){this.$streamerBlocker.show(),c.change(".streamer-type","",!1),c.change(".streamer.content","",!1);var b=c.$form.find(".button.streamer");b.hasClass("active")&&b.trigger("click")}else this.$streamerBlocker.hide()},toggleTitleBlocker:function(a){var b=c.$form.find("input.pre-title");a?(this.$preTitleBlocker.show().css("top",b.position().top+"px"),this.$titleSizeBlocker.show().css("top",b.position().top+"px"),b.attr("disabled","disabled").val("")):(this.$preTitleBlocker.hide(),this.$titleSizeBlocker.hide(),b.removeAttr("disabled"))},removeBlockers:function(){this.toggleStreamerBlocker(!1),this.toggleTitleBlocker(!1),this.toggleFormBlocker(!1),this.toggleImageAlignBlocker(!1),c.$form.find("input.pre-title").removeAttr("disabled")},addBlocker:function(a){switch(a){case"streamer":this.toggleStreamerBlocker(!0);break;case"title":this.toggleTitleBlocker(!0);break;case"image-align":this.toggleImageAlignBlocker(!0);break;default:return!1}return!0},init:function(){this.$formBlocker=a('<div class="form-blocker blocker"></div>').appendTo(c.$form),this.$streamerBlocker=a('<div class="streamer-blocker blocker"></div>').appendTo(c.$form),this.$preTitleBlocker=a('<div class="pre-title-blocker blocker"></div>').appendTo(c.$form),this.$titleSizeBlocker=a('<div class="title-size-blocker blocker"></div>').appendTo(c.$form),this.$imgAlignBlocker=a('<div class="img-align-blocker blocker"></div>').appendTo(c.$form),c.$form.bind("open",function(){if(d.$formBlocker.is(":visible"))d.updateFormBlockerSize();else if(d.$titleSizeBlocker.is(":visible")){var a=c.$form.find("input.pre-title");d.$preTitleBlocker.show().css("top",a.position().top+"px"),d.$titleSizeBlocker.show().css("top",a.position().top+"px")}}),a(b).bind("arlimaFormImageLoaded",function(){d.$formBlocker.is(":visible")&&d.updateFormBlockerSize()})}};return d}(jQuery,window,ArlimaArticleForm),ArlimaTemplateLoader=function(a){"use strict";var b=function(a){return"/"==a.substr(a.length-1,1)&&(a=a.substr(0,a.length-1)),a.substr(0,a.lastIndexOf("/"))};return{isRequestingTemplate:!1,finishedLoading:!1,templates:{},_templateSupport:{},_templatesToLoad:[],_templateParts:{},load:function(a){this.finishedLoading=!1,this._templatesToLoad=a,this._loadNextTemplate()},templateSupport:function(a,b){return b?void 0===this._templateSupport[a]?void 0:this._templateSupport[a][b]:this._templateSupport[a]},getTemplateSupport:function(a){return this.templateSupport(a.getTemplate())||{}},_loadNextTemplate:function(){var b=this;if(this.isRequestingTemplate)setTimeout(function(){b._loadNextTemplate()},200);else if(this._templatesToLoad.length>0){var c=this._templatesToLoad.splice(0,1)[0];3==c.length&&(c=c[1]),this._loadTemplate(c,function(d,e){b._templateParts[c]=d,a.each(b._parseIncludes(d,e),function(a,c){b._templatesToLoad.push(c)}),b._loadNextTemplate()})}else this._buildTemplates(),this.finishedLoading=!0},_parseIncludes:function(b,c){var d=b.match(/\{\{include [0-9a-z\/A-Z\-\_\.]*\}\}/g);if(d){var e=this;return a.each(d,function(a,b){var f=b.replace("{{include ","").replace("}}","");d[a]=[b,e._makeTemplateURL(c,f),c]}),d}return[]},_makeTemplateURL:function(b,c){var d=b+c;if(d.indexOf("../")>-1){var e=d.substr(d.indexOf("://")+3).split("/"),f=[];return a.each(e,function(a,b){".."==b?f.splice(-1):f.push(b)}),d.substr(0,d.indexOf("://"))+"://"+f.join("/")}return d},_buildTemplates:function(){var b=this;a.each(this._templateParts,function(a,c){var d=b.extractFileNameFromURL(a),e=a.substr(0,a.lastIndexOf("/"))+"/";b.templates[d]=c;for(var f=b._parseIncludes(b.templates[d],e);f&&f.length>0;){for(var g=0;g<f.length;g++)b.templates[d]=b.templates[d].replace(f[g][0],b._templateParts[f[g][1]]);f=b._parseIncludes(b.templates[d],e)}}),a.each(this.templates,function(c,d){var e={},f=d.match(new RegExp("({{image-support .*}})","g"));if(f&&f[0]){b.templates[c]=d.replace(new RegExp("({{image-support .*}})","g"),"");var g=a.trim(f[0].substr(f[0].indexOf(" ")).replace("}}",""));e.imageSize={},a.each(a("<div "+g+"></div>").get(0).attributes,function(a,b){g.indexOf(b.name)>-1&&(e.imageSize[b.name]=b.value)})}e.image=d.indexOf("{{image.url}}")>-1||d.indexOf("{{{html_image}}}")>-1,e.streamer=d.indexOf("{{html_streamer}}")>-1||d.indexOf("{{options.streamer")>-1,e.editor=d.indexOf("{{html_content}}")>-1||d.indexOf("{{content}}")>-1,e.title=d.indexOf("{{html_title}}")>-1||d.indexOf("{{title}}")>-1,b._templateSupport[c]=e}),delete this._templateParts},extractFileNameFromURL:function(a){var b=a.substr(a.lastIndexOf("/")+1,a.length);return b.substr(0,b.indexOf("."))},_loadTemplate:function(c,d){this.isRequestingTemplate=!0;var e=this;a.ajax({dataType:"text",url:c,success:function(a){e.isRequestingTemplate=!1,d(a,b(c)+"/")},error:function(){ArlimaUtils.log("Unable to load template "+c,"error"),e.isRequestingTemplate=!1,d("<!-- ! Missing template "+c+" -->",b(c)+"/")}})}}}(jQuery),ArlimaVersionManager=function(a,b){var c={versions:!1,versionsInFront:!1,setArticle:function(a){this.clear(),this.addVersion(a)},addVersion:function(a){this.versions.push(JSON.stringify(a.data)),this.versions.length>50&&this.versions.splice(0,1)},stepBack:function(){this.versions.length>1&&(this.versionsInFront.push(this.versions.splice(-1)),d())},stepForward:function(){this.versionsInFront.length>0&&(this.versions.push(this.versionsInFront.splice(-1)),d())},clear:function(){this.versions=[],this.versionsInFront=[]}},d=function(){b.article.setData(JSON.parse(c.versions[c.versions.length-1])),b.setupForm(),b.toggleUnsavedState("unsaved")};return c}(jQuery,ArlimaArticleForm),ArlimaListContainer=function(a,b,c,d,e,f){"use strict";var g=parseInt(e.scheduledListReloadTime,10),h=!1,i=0,j=a(b);return g&&30>g&&(f.log("You can not set lists to be reloaded more often than every 30 seconds","warn"),g=30),{lists:{},$elem:null,lastTouchedList:null,add:function(c,d){if(1==e.limitAccessToLists){if(-1==e.userAllowedLists)return;if(e.userAllowedLists instanceof Array&&-1==a.inArray(""+c.data.id,e.userAllowedLists))return}this.$elem.append(c.$elem),i++,Number.MAX_VALUE==i&&(i=1),d||(d={left:"5px",top:"5px",width:"300px",height:"400px"}),d.zIndex=i,c.zIndex=i,c.$elem.css(d),this.lists[c.data.id.toString()]=c,h=c.data.id,c.$elem.trigger("Arlima.addedToContainer"),j.trigger("Arlima.listAddedToContainer",c);var k=this;if(c.$elem.bind("change click dragged resized",function(){k.lastTouchedList=c.data.id}),g&&!c.data.isImported){var l=function(){var a,d=function(){c.displayTitleMessage(!1),c.reloadStep=0,a=g-10},h=c.hasUnsavedChanges()||c.hasLoadedScheduledVersion()||b.stopListReload||2==c.reloadStep&&ArlimaArticleForm.isEditing(c.data.id);if(h)f.log("Ignoring background reload of list "+c),d();else if(c.reloadStep++,1==c.reloadStep)c.displayTitleMessage(e.lang.willReload+" 10 "+e.lang.seconds,!1),a=5;else if(2==c.reloadStep)c.displayTitleMessage(e.lang.willReload+" 5 "+e.lang.seconds,!1),a=5;else{d();var i=c.data.version.id;c.reload(!1,function(a){if(a.data.version.id!=i){var b=a.data.versionDisplayText.split(" "),c=b.splice(-2).join(" ");a.displayTitleMessage(e.lang.updatedBy+" "+c,8,"#e1b621")}})}c.reloadInterval=setTimeout(l,1e3*a)};c.reloadStep=0,c.reloadInterval=setTimeout(l,1e3*(g-10))}c.$elem.addClass("pulse"),setTimeout(function(){c.$elem.removeClass("pulse")},750)},focus:function(b){if(h!=b.data.id){h=b.data.id;var c={},d=[],e=!1;a.each(this.lists,function(a,b){c[b.zIndex]=b,d.push(b.zIndex)}),d.sort(),a.each(d,function(a,d){if(e){var f=e;e=d,c[d].zIndex=f,c[d].$elem.css("z-index",f)}else c[d].data.id==b.data.id&&(e=d)}),e&&(b.zIndex=e,b.$elem.css("z-index",e))}},updateZIndexes:function(){a.each(this.lists,function(a,b){b.zIndex&&b.zIndex!=b.$elem.css("z-index")&&b.$elem.css("z-index",b.zIndex)})},remove:function(c,d){"object"!=typeof c&&(c=this.list(c)),b.ArlimaArticleForm.isEditing(c.data.id)&&b.ArlimaArticleForm.clear();var g=!0;c.hasUnsavedChanges()&&!f.hasMetaKeyPressed(d)&&(g=confirm(e.lang.changesBeforeRemove)),g&&(c.reloadInterval&&clearInterval(c.reloadInterval),c.$elem.trigger("removedFromContainer"),c.$elem.fadeOut(function(){a(this).remove()}),delete this.lists[c.data.id.toString()])},saveListSetup:function(b){var d=[];a.each(this.lists,function(a,b){var c=b.$elem.position();d.push({alid:a,top:c.top,left:c.left,width:b.$elem.width(),height:b.$elem.height()})}),c.saveListSetup(d,function(){"function"==typeof b&&b()})},loadListSetup:function(e){c.loadListSetup(function(c){if(c){var f=c.length;if(0==f)e();else{var g=function(a,c){d.load(a,function(a){a&&b.ArlimaListContainer.add(a,c),f--,0==f&&e()})};a.each(c,function(a,b){g(b.alid,{top:parseInt(b.top,10),left:parseInt(b.left,10),height:parseInt(b.height,10),width:parseInt(b.width,10)})})}}else e()})},showAsActive:function(b){a.each(this.lists,function(a,b){return b.$elem.hasClass("active")?(b.$elem.removeClass("active"),!1):void 0}),b&&!this.list(b).data.isImported&&this.list(b).$elem.addClass("active")},list:function(a){return"object"==typeof a&&"listID"in a?this.lists[a.listID]:this.lists[a]},init:function(b,c){this.$elem=b;var d=this;b.find(".ajax-loader").show(),this.loadListSetup(function(){b.find(".ajax-loader").hide(),j.trigger("Arlima.listSetupLoaded")}),c.find(".refresh-lists").on("click",function(b){var c=!1;a.each(d.lists,function(a,b){return b.hasUnsavedChanges()?(c=!0,!1):void 0});var g=!0;return c&&!f.hasMetaKeyPressed(b)&&(g=confirm(e.lang.unsaved)),g&&a.each(d.lists,function(a,b){b.reload()}),!1}),c.find(".save").on("click",function(){c.find(".ajax-loader").show(),ArlimaListContainer.saveListSetup(function(){c.find(".ajax-loader").hide()})})}}}(jQuery,window,ArlimaBackend,ArlimaListLoader,ArlimaJS,ArlimaUtils),ArlimaKeyBoardShortCuts=function(a,b,c,d,e){"use strict";var f={p:{key:80,run:function(){e.article&&c.toggle()}},s:{key:83,run:function(){var a=b.ArlimaUtils.getUnsavedListInFocus();a&&a.save()}},l:{key:76,run:function(){var a=b.ArlimaUtils.getUnsavedListInFocus();a?a.preview():e.article&&b.ArlimaListContainer.list(e.article.listID).preview()}},y:{key:89,run:function(){e.article&&d.stepForward()}},z:{key:90,run:function(){e.article&&d.stepBack()}},getCommandFromEvent:function(b,c){var d=b.keyCode||b.which;return(b.ctrlKey||b.metaKey)&&a.inArray(d,c)>-1?d:!1}};return{call:function(a,b){var c=f.getCommandFromEvent(a,b);if(c){switch(c){case f.p.key:f.p.run();break;case f.s.key:f.s.run();break;case f.l.key:f.l.run();break;case f.y.key:if(a.target&&"INPUT"==a.target.nodeName)return!1;f.y.run();break;case f.z.key:if(a.target&&"INPUT"==a.target.nodeName)return!1;a.shiftKey?f.y.run():f.z.run()}return!0}return!1},getKeyList:function(b){var c=[];return b?a.each(b.split(""),function(a,b){c.push(f[b].key)}):a.each(this,function(a,b){"function"!=typeof b&&c.push(b.key)}),c},init:function(){var c=this,d=this.getKeyList("plszy");a(b.document).bind("keydown",function(a){return c.call(a,d)?(a.preventDefault(),!1):void 0})}}}(jQuery,window,ArlimaArticlePreview,ArlimaVersionManager,ArlimaArticleForm),ArlimaListPreview=function(a,b,c,d){var e=a(b),f={list:null,previewWindow:!1,preview:function(a){if(!a.data.previewURL)return void alert(ArlimaJS.lang.missingPreviewPage);if(!a.hasUnsavedChanges()){var e=i(a.data.previewURL,(new Date).getTime(),"_");return void h(g(e))}if(a.toggleAjaxPreLoader(!0),this.list=a,this.previewWindow)try{this.previewWindow.close()}catch(k){}b.ArlimaBackend.savePreview(a.data.id,a.getArticleData(),function(e){if(f.list.toggleAjaxPreLoader(!1),e){var k=i(a.data.previewURL,a.data.id);f.previewWindow=g(k,function(a){if(j(a("body")),a(f.previewWindow.document).keydown(function(a){var d=a.keyCode?a.keyCode:a.which;return 83==d&&c.hasMetaKeyPressed(a)?(f.list.save(),f.previewWindow.close(),b.focus(),f.previewWindow=!1,a.preventDefault(),!1):void 0}),d.currentPost&&d.currentPost.ID){var e=a("*[data-post='"+d.currentPost.ID+"']").first();e.length>0&&a(f.previewWindow).scrollTop(e.position().top-80)}}),h(f.previewWindow)}})}},g=function(a,c){var d="arlima"+(new Date).getTime(),e=b.open(a,d,"toolbar=1,scrollbars=1,width=10,height=10");if(e)var f=setInterval(function(){e.jQuery&&(clearInterval(f),e.jQuery(function(a){a("body").css("margin-top","-32px"),a("#wpadminbar").remove(),"function"==typeof c&&c(a)}))},300);else alert("Your browser has blocked the pop-up window!");return e},h=function(a){a&&(a.resizeTo(e.width(),e.height()),a.focus())},i=function(a,c,d){return d=d||b.ArlimaJS.previewQueryArg,a+(a.indexOf("?")>-1?"&":"?")+d+"="+c},j=function(c){var d=a("<div></div>");d.css({position:"fixed",top:"20px",left:"0",width:"100%",zIndex:"9999"}).appendTo(c);var e=-1==b.navigator.userAgent.indexOf("Mac")?"ctrl":"cmd";a("<div></div>").text(e+" + s "+b.ArlimaJS.lang.savePreview+' "'+f.list.data.title+'"').css({background:"#222",backgroundColor:"rgba(0,0,0, .85)",fontSize:"13px",color:"#FFF",margin:"16px",padding:"10px",webkitborderRadius:"12px",mozBorderRadius:"13px",borderRadius:"12px",fontWeight:"bold",webkitBoxShadow:"0 0 7px #333",mozBoxShadow:"0 0 7px #333",boxShadow:"0 0 7px #333"}).appendTo(d)};return f}(jQuery,window,ArlimaUtils,ArlimaArticleConnection),ArlimaImageManager=function(a,b,c,d,e){"use strict";var f={$elem:!1,$imageWrapper:!1,$sizeSelect:!1,$alignButtons:!1,$buttons:!1,$selects:!1,article:!1,setup:function(a){this.article=a,k()},removeImage:function(){this.article.data.image={},c.change(".image-attach",""),k()},setNewImage:function(a,b,d,e,g){e=e||i(),g=g||"","full"==e&&""!=g?g="":"full"!=e&&""==g&&(g="alignleft"),f.article.data.image={size:e,url:a,alignment:g,attachment:b,connected:d?1:""},c.change(".image-attach",b),setTimeout(k,200)},init:function(d){this.$elem=d,this.$imageWrapper=d.find(".image"),this.$buttons=d.find(".button"),this.$alignButtons=d.find(".align-button"),this.$sizeSelect=d.find("select.img-size");var e=d.find(".attachments-fancybox");b.ArlimaJS.hasScissors?ArlimaScissors.init(this.$buttons.filter(".scissors")):this.$buttons.filter(".scissors").remove(),this.$buttons.filter(".remove").click(function(){return f.removeImage(),!1}),this.$buttons.filter(".browse").click(function(){var a=f.article?parseInt(f.article.data.post,10):null;return b.wpMediaModal?(b.wpMediaModal.uploader.uploader.param("post_id",a),void b.wpMediaModal.open()):(wp.media.model.settings.post.id=a,b.wpMediaModal=wp.media.frames.file_frame=wp.media({title:b.ArlimaJS.lang.chooseImage,button:{text:b.ArlimaJS.insertImage},multiple:!1}),b.wpMediaModal.on("select",function(){var c=b.wpMediaModal.state().get("selection").first().toJSON(),d=a?!0:!1;b.ArlimaUtils.isImagePath(c.url)?(a&&!c.uploadedTo&&ArlimaBackend.connectAttachmentToPost(a,c.id),f.setNewImage(c.url,c.id,d)):alert(b.ArlimaJS.lang.onlyImages)}),b.wpMediaModal.open(),!1)}),f.$sizeSelect.on("change",function(){h(f.$sizeSelect.val(),!0)}),f.$alignButtons.on("change",function(){c.change(".data.img-align",a(this).val(),!0)}),this.$buttons.filter(".disconnect").click(function(){return a(this).hide(),f.article.data.image.connected="",ArlimaBackend.duplicateImage(f.article.data.image.attachment,function(a){a.error||f.setNewImage(a.attach_url,a.attach_id,!1,f.article.data.image.size,f.article.data.image.alignment)}),!1}),this.$imageWrapper.click(function(){return f.article&&parseInt(f.article.data.post,10)&&b.ArlimaBackend.getPostAttachments(f.article.data.post,function(b){e.html(""),a.each(b,function(b,c){a("<div></div>").addClass("arlima-article-attachment").html(c.thumb).on("click",function(){f.setNewImage(c.url[0],c.attachment,!0),a(".fancybox-close").trigger("click")}).appendTo(e)}),a.fancybox({minHeight:200,href:"#arlima-article-attachments"})}),!1})}},g=function(c){if(c){var d=a('<img src="'+f.article.data.image.url+'" />');d.load(function(){a(b).trigger("arlimaFormImageLoaded"),j(this)}),f.$imageWrapper.html(d).removeClass("no-image")}else f.$imageWrapper.hasClass("no-image")||f.$imageWrapper.html('<i class="fa fa-camera-retro fa-5x"></i>').addClass("no-image")},h=function(a,b){a||(a=f.article.data.image.size),void 0===b&&(b=!1);var d=f.$alignButtons.filter(":checked");if("full"==a)0!=d.length&&(d[0].checked=!1),e.toggleImageAlignBlocker(!0),c.change(".data.img-align","",b);else{var g=f.article.data.image.alignment;g?f.$alignButtons.filter('[value="'+g+'"]').get(0).checked=!0:(f.$alignButtons[0].checked=!0,b=!0),e.toggleImageAlignBlocker(!1),b&&c.change(".data.img-align",f.$alignButtons.eq(0).val(),!0)}},i=function(){var b=d.getTemplateSupport(f.article).imageSize;if(b){if(f.article.isChild()&&b["children-size"]&&"*"!=b["children-size"])return a.trim(b["children-size"].split(",")[0]);if(b.size&&"*"!=b.size)return a.trim(b.size.split(",")[0])}return"full"},j=function(a){b.ArlimaImageUploader.createDropZone(a)},k=function(){try{if(f.article.data.image&&f.article.data.image.url){var c=f.article.data.image;b.ArlimaUtils.log("Setting up image form for "+f.article.data.id),g(!0),f.$buttons.show(),f.$alignButtons.parent().show(),f.$sizeSelect.show();var e=d.getTemplateSupport(f.article).imageSize,j=!1;if(e)if(f.article.isChild()&&e["children-size"]&&"*"!=e["children-size"]?j=e["children-size"].split(","):!f.article.isChild()&&e.size&&"*"!=e.size&&(j=e.size.split(",")),j){var k=!1,l=f.$sizeSelect.find("option");l.attr("disabled","disabled"),a.each(j,function(b,d){d=a.trim(d),l.filter('[value="'+d+'"]').removeAttr("disabled"),d==c.size&&(k=!0)}),k||(c.size=i())}else f.$sizeSelect.find("option").removeAttr("disabled");else f.$sizeSelect.find("option").removeAttr("disabled");c.connected||f.$buttons.filter(".disconnect").hide(),c.alignment=c.alignment||"","full"==c.size&&""!=c.alignment?c.alignment="":"full"!=c.size&&""==c.alignment&&(c.alignment="alignleft"),c.alignment&&(f.$alignButtons.filter("[value="+c.alignment+"]")[0].checked=!0),ArlimaUtils.selectVal(f.$sizeSelect,c.size,!1),h()}else g(!1),f.$buttons.filter(":not(.browse)").hide(),f.$alignButtons.parent().hide(),f.$sizeSelect.hide()}catch(m){b.ArlimaUtils.log(m)}};return f}(jQuery,window,ArlimaArticleForm,ArlimaTemplateLoader,ArlimaFormBlocker),ArlimaImageUploader=function(a,b,c,d,e){"use strict";var f,g=["jpeg","jpg","gif","png"],h=5,i=function(b){b.ondragover=function(a){a.dataTransfer.dropEffect="copy"},b.ondragenter=function(){a(b).addClass("dragover")},b.ondragleave=function(){a(b).removeClass("dragover")},b.ondrop=function(){a(b).removeClass("dragover")}},j=function(d,e,f,i){var j=!0;if(a.each(g,function(a,b){return d.toLowerCase().indexOf(b)>-1?(j=!1,!1):void 0}),j)return k.showNotice("File was not an image"),void setTimeout(function(){k.removeNotice()},2e3);if(e>1024*h*1024)return k.showNotice("Image is to big (max "+h+" MB)"),void setTimeout(function(){k.removeNotice()},2e3);var l=new b.FileReader,m=function(a){0===a.indexOf("data:")&&(a=a.substr(a.indexOf(",")+1)),k.showPreloader(),b.ArlimaBackend.saveImage(a,c.article?c.article.data.post:"",f,function(a){k.removeNotice(),a&&ArlimaImageManager.setNewImage(a.url,a.attachment,c.article.data.post?!0:!1)})};"string"==typeof i?m(i):(l.onloadend=function(){m(l.result)},l.onerror=function(a){var b="";switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:b="File not found!";break;case a.target.error.NOT_READABLE_ERR:b="File not readable!";break;case a.target.error.ABORT_ERR:b="Aborted";break;default:b="Unkown..."}k.showNotice(b)},l.readAsDataURL(i))},k={$notifyElement:!1,$mainUploadElement:!1,showPreloader:function(){var a='<i class="fa fa-cog fa-spin large fa-5x"></i>';this.$mainUploadElement.find("img").css("opacity","0.75"),this.$notifyElement?this.$notifyElement.html(a):this.showNotice(a)},removeNotice:function(){this.$notifyElement&&(this.$mainUploadElement.find("img").css("opacity","1"),this.$notifyElement.fadeOut("slow",function(){a(this).remove()}),this.$notifyElement=!1)},showNotice:function(b){this.$notifyElement||(this.$notifyElement=a('<div class="file-progress"></div>'),this.$notifyElement.appendTo(this.$mainUploadElement)),0!==b.indexOf("<")&&(b="<p>"+b+"</p>"),this.$notifyElement.html("").append(b)},createDropZone:function(a){if("mOxie"in b){var c=new b.mOxie.FileDrop({drop_zone:a});new mOxie.Image,c.ondrop=function(){var a=new mOxie.Image;a.onload=function(){j(c.files[0].type,c.files[0].size,c.files[0].name,a.getAsDataURL())},a.load(c.files[0])},c.bind("init",function(){f.features.dragdrop&&i(a)}),c.init(),i(a)}},init:function(c,d){"FileReader"in b&&(this.$mainUploadElement=c.find(".image"),f=new e.Uploader({runtimes:"html5,html4",drop_element:d,container:"fake-container",dragdrop:!0}),f.bind("Init",function(){f.features.dragdrop&&i(a("#"+d).get(0))}),f.bind("FilesAdded",function(a,b){return j(b[0]["native"].type,b[0]["native"].size,b[0]["native"].name,b[0]["native"])}),f.init())}};return k}(jQuery,window,ArlimaArticleForm,ArlimaJS,plupload),ArlimaFileIncludes=function(a,b,c,d){return{$elem:!1,getFormFieldsDefinition:function(b){return b=b.replace("//","/"),a.extend(!0,{},this.$elem.find('.file-include[data-file="'+b+'"]').get(0).arlimaFormFields)},parseQueryString:function(b){var c={};return a.each(b.split("&"),function(a,b){c[b.split("&")[0]]=b.split("&")[1]}),c},init:function(b){this.$elem=b,c.makeCollapsing(b),this.$elem.find(".file-include").each(function(b,c){var e=a(c),f=a.parseJSON(e.attr("data-args"));c.arlimaArticle=new ArlimaArticle({title:e.data("label"),options:{fileInclude:a(c).data("file")}}),a.each(f,function(b,c){var e={type:d.TYPES.TEXT,property:b,value:c,width:"80%",label:{text:b}};"boolean"==typeof c?e.type=d.TYPES.BOOL:a.isNumeric(c)?e.type=d.TYPES.NUMBER:"string"!=typeof c&&(e=c),f[b]=a.extend(!0,{},d.defaultFieldDefinition,e)}),c.arlimaFormFields=f,e.draggable({appendTo:"body",helper:"clone",sender:"postlist",connectToSortable:".article-list .articles",revert:"invalid",start:function(a,b){b.helper.html('<div class="article-title-container"><span>'+b.helper.html()+"</span></div>"),b.helper.addClass("article"),b.helper.css("z-index","99999")}})}),b.find(".include-group thead td").click(function(){var b=a(this),c=b.closest(".include-group");c.hasClass("open")?(c.removeClass("open"),b.closest("table").find("tbody").hide()):(c.addClass("open"),b.closest("table").find("tbody").show())})}}}(jQuery,window,ArlimaUtils,ArlimaFormBuilder),ArlimaScissors=function(a,b,c,d,e){var f={},g={init:function(f){var h=a("#image-scissors-popup"),i=!1,j=!1;f.fancybox({autoResize:1,fitToView:1,margin:new Array(40,0,0,0),speedIn:300,speedOut:300,titlePosition:"over",autoDimensions:!0,afterClose:function(){if(i){var a=e.$imageWrapper.find("img");a.attr("src",a.attr("src")+"?"+Math.random()),d.removeImageVersions(j.attachment),e.setNewImage(j.url.split("?")[0]+"?edited="+(new Date).getTime(),j.attachment,j.connected,j.size,j.alignment,!0),c.$form.find(".image-attach").trigger("change"),b.ArlimaArticlePreview.isVisible()&&b.ArlimaArticlePreview.reload()}},beforeLoad:function(){j=c.article.data.image,i=!1,h.html('<div id="media-item-'+j.attachment+'">'+e.$imageWrapper.html()+"</div>"),h.find("img").addClass("thumbnail").css("max-width","200px"),d.loadScissorsHTML(j.attachment,function(a){a&&(h.append(a),h.find("#scissorsShowBtn-"+j.attachment+" button").click(function(){i=!0}))})}}),document.addEventListener("DOMNodeInserted",function(b){b.target&&b.target.id&&(0===b.target.id.indexOf("scissorsCrop")?g.modifyScissorsEditor(a(this)):0===b.target.id.indexOf("scissorsWatermark")&&g.modifyScissorsWatermarkEditor(a(this)))})},monkeyPatchScissors:function(){var a=f;if(!a.showCrop){a.crop=b.scissorsCrop,a.showCrop=b.scissorsShowCrop,a.abortCrop=b.scissorsAbortCrop;var c=function(){b.scissorsCrop=a.crop,b.scissorsShowCrop=a.showCrop,b.scissorsAbortCrop=a.abortCrop,jQuery.fancybox.helpers.overlay.open(),a=f={}};b.scissorsShowCrop=function(b,c){var d=a.showCrop(b,c),e=jQuery.fancybox.helpers.overlay;return e.overlay.unbind("click"),d},b.scissorsCrop=function(b,d){var e=a.crop(b,d);return c(),e},b.scissorsAbortCrop=function(b){var d=a.abortCrop(b);return c(),d}}},modifyScissorsEditor:function(b){var d=c.article.data.image.attachment;a.each(ArlimaJSAdmin.scissorsCropTemplates,function(a,b){h(a,b[0],b[1],d)});try{g.monkeyPatchScissors()}catch(e){ArlimaUtils.log("Error when monkey-patching scissors: "+e.toString(),"error")}b.find('input[type="checkbox"]').each(function(){this.id&&0==this.id.indexOf("scissorsLockBox")&&a(this).prop("checked",!1)}),b.find("div").each(function(){this.id&&0==this.id.indexOf("scissorsReir")&&a("#"+this.id).hide()})},modifyScissorsWatermarkEditor:function(b){b.find('input[type="checkbox"]').each(function(){if(this.id&&0==this.id.indexOf("scissors_watermark_target")){var b=this.id.split("_");void 0!==b[3]&&(b=b[3].split("-"),a(this).prop("checked",!0),scissorsWatermarkStateChanged(b[b.length-1],b[0]))}})}},h=function(b,c,d,e){a("<button></button>").html(b).addClass("button").appendTo("#scissorsCropPane-"+e).bind("click",function(){return a("#scissorsLockBox-"+e).prop("checked",!0),scissorsAspectChange(e),a("#scissorsLockX-"+e).val(c),a("#scissorsLockY-"+e).val(d),scissorsManualAspectChange(e),!1
})};return g}(jQuery,window,ArlimaArticleForm,ArlimaBackend,ArlimaImageManager),ArlimaArticlePreset=function(a,b,c,d){return{init:function(b){var e=b.find("tbody");d.makeCollapsing(b),c.loadCustomTemplateData(function(b){b&&a.each(b,function(b,c){var f=a("<tr><td><div>"+c.name+"</div></td></tr>");f.find("div").get(0).arlimaArticle=new ArlimaArticle(c),e.append(f),d.makeDraggable(f.find("div").eq(0))})})}}}(jQuery,window,ArlimaBackend,ArlimaUtils),ArlimaScheduledIntervalPicker=function(a,b,c){var d={$fancyBox:!1,open:function(){a.fancybox({href:"#scheduled-interval-fancybox",height:400,width:400,beforeLoad:function(){var b=c.article.opt("scheduledInterval");b||(b="*:*",c.change(".scheduled-interval",b,!0));var e=d.$fancyBox.find("input");e.removeAttr("checked"),a.each(b.split(":"),function(b,c){if("*"==a.trim(c)){var d=0==b?".day":".hour";e.filter(d).attr("checked","checked")}else a.each(c.split(","),function(a,b){e.filter('[value="'+b+'"]').attr("checked","checked")})})},afterClose:function(){var a=function(a){var b="*",c=d.$fancyBox.find("."+a);return c.filter(":checked").length!=c.length&&(b="",c.filter(":checked").each(function(){b+=","+this.value}),b=""==b?"*":b.substr(1)),b},b=a("day")+":"+a("hour");b!=c.article.opt("scheduledInterval")&&c.change(".scheduled-interval",b,!0)}})},removePickedInterval:function(){c.change(".scheduled-interval","",!0)},init:function(b){for(var c=b.find(".hours").children().eq(0),d=1;25>d;d++){var e=10>d?"0"+d:d,f=d%8===0?"<br />":"";a('<label><input type="checkbox" class="hour" value="'+e+'" /> '+e+"</label>"+f).insertBefore(c)}b.find(".toggler").click(function(){var b=a(this).parent().parent().find("input");return b.filter(":checked").length?b.removeAttr("checked"):b.attr("checked","checked"),!1}),this.$fancyBox=b}};return d}(jQuery,window,ArlimaArticleForm),ArlimaTinyMCE=function(a,b,c,d,e,f){var g=f.getKeyList("pls");return{hasActiveEditor:function(){return b.tinyMCE&&b.tinyMCE.activeEditor&&!b.tinyMCE.activeEditor.isHidden()},getEditorContent:function(){return this.hasActiveEditor()?b.tinyMCE.activeEditor.getContent():a("#tinyMCE").val()},setEditorContent:function(c){this.hasActiveEditor()?b.tinyMCE.activeEditor.setContent(c):a("#tinyMCE").val(c)},init:function(){var c=this,d="",h=function(a,b){var c=b||a;return f.call(c,g)?(c.preventDefault(),!1):!0},i=function(b){b.selection||(d=a.trim(c.getEditorContent()))},j=function(){var b=a.trim(c.getEditorContent());b!=d&&(e.change("input.text",c.getEditorContent(),!0),d=b)},k=setInterval(function(){c.hasActiveEditor()&&(clearInterval(k),b.tinyMCE.majorVersion>3?(b.tinyMCE.editors[0].on("setContent",i),b.tinyMCE.editors[0].on("change",j),b.tinyMCE.editors[0].on("keyUp",j),b.tinyMCE.editors[0].on("keyDown",h)):(b.tinyMCE.editors[0].onSetContent.add(i),b.tinyMCE.editors[0].onKeyUp.add(j),b.tinyMCE.editors[0].onChange.add(j),b.tinyMCE.editors[0].onKeyDown.add(h)))},500);a("#tinyMCE").on("keyup",j)}}}(jQuery,window,ArlimaArticlePreview,ArlimaVersionManager,ArlimaArticleForm,ArlimaKeyBoardShortCuts);